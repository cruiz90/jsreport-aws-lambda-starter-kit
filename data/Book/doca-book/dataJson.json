{
    "result": {
        "title": "NVIDIA Network Operator v24.4.0 Edit",
        "copyright": "© Copyright 2024, NVIDIA.",
        "figures": [],
        "tables": [],
        "body": "<html><head></head><body><p>The NVIDIA Network Operator simplifies the provisioning and management of NVIDIA networking resources in a Kubernetes cluster. The operator automatically installs the required host networking software - bringing together all the needed components to provide high-speed network connectivity. These components include the NVIDIA networking driver, Kubernetes device plugin, CNI plugins, IP address management (IPAM) plugin and others. The NVIDIA Network Operator works in conjunction with the NVIDIA GPU Operator to deliver high-throughput, low-latency networking for scale-out, GPU computing clusters.</p> <p>A Helm chart is provided for easily deploying the Network operator in a cluster to provision the host software on NVIDIA-enabled nodes.</p> <h2 id=\"license_agreement\">License Agreement</h2> <p>The NVIDIA Network Operator is licensed under Apache 2.0 and contributions are accepted with a DCO. See the contributing document for more information on how to contribute and the release artifacts.</p> <h2 id=\"learn_more\">Learn More</h2> <p>The Network Operator is open-source. For more information on contributions and release artifacts, see the <a class=\"reference external\" href=\"https://github.com/Mellanox/network-operator\" target=\"_self\">GitHub repo</a>.</p></body></html>",
        "topicPages": [
          {
                "title": "Release Notes",
                "topicId": "release_notes",
                "figures": [],
                "copyright": "© Copyright 2024, NVIDIA.",
                "table": [],
                "body": "<html><head></head><body><div> <p class=\"topic-title\">On this page</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#changes_and_new_features\">Changes and New Features</a></p></li> <li class=\"has-marker\"><p><a href=\"#general_support\">General Support</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#upgrade_notes\">Upgrade Notes</a></p></li> <li class=\"has-marker\"><p><a href=\"#bug_fixes\">Bug Fixes</a></p></li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#known_limitations\">Known Limitations</a></p></li> </ul> <br><h2 id=\"changes_and_new_features\">Changes and New Features</h2><table> <colgroup> <col style=\"width: 12%\"> <col style=\"width: 88%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Version</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>24.4.0</td> <td> - Added support for OpenShift Container Platform v4.15.<br> - Added support for Ubuntu 24.04.<br> - Added support for NVIDIA Grace based ARM platforms with Ubuntu 22.04 and Upstream K8s as a Tech Preview feature.<br> - Added support for NVIDIA IGX Orin based ARM platforms with Ubuntu 22.04 and Upstream K8s as a GA feature.<br> - Added support for Precompiled DOCA Driver containers for Ubuntu 22.04.<br> - Added support for Switchdev SR-IOV mode with SR-IOV Network Operator and OVS CNI as a Tech Preview feature.<br> - Added support for DOCA Telemetry Service (DTS) integration to expose network telemetry and NIC metrics in K8s.<br> - Added support for network namespace isolation of RDMA devices with RDMA CNI<br> - Added support for RHEL and OpenShift deployments with Real-time kernels.<br> - Enhanced DOCA Driver container deployment and significantly reduced compilation time after node reboots.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>24.1.0</td> <td> - Added support for Ubuntu 22.04 with Upstream K8s on ARM platforms (NVIDIA IGX Orin) - Tech Preview.<br> - Added support for CNI bin directory configuration.<br> - Added support for OpenShift MOFED/DOCA driver container build and deployment via driver toolkit (DTK).<br> - Added support for Ubuntu 22.04 deployments with Real-time kernels.<br> - Added the ability to disable SR-IOV VF for SR-IOV Network Operator (in systems with pre-configured SR-IOV).<br> - Added the ability to set resource request and limits on the network operator and it components.<br> <br> </td> </tr> <tr class=\"row-even\"><td>23.10.0</td> <td> - Added support for OpenShift Container Platform v4.14.<br> - Added support for RHEL v8.8.<br> - Optimized SR-IOV NIC configuration time with Network Operator (vanilla Kubernetes only).<br> - Added a validating admission controller for NVIDIA Network Operator.<br> - Added support for NIC Feature Discovery (driver version discovery).<br> - Added CDI support for SR-IOV Network Device Plugin and RDMA Shared Device Plugin for network device persistency.<br> - Added support for NVIDIA BlueField-3 NIC mode.<br> - Added High-Availability and Leader election support for NV-IPAM.<br> - Added systemd mode support for SR-IOV Network Operator and MOFED container to optimize cluster/node startup time.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>23.7.0</td> <td> - Added support for OpenShift Container Platform 4.13.<br> - Added support for RHEL 9.1 and 9.2 with CRI-O container runtime (Beta).<br> - Added support for NodeFeatureApi in Node Feature Discovery.<br> <br> </td> </tr> <tr class=\"row-even\"><td>23.5.0</td> <td> - Added support for NVIDIA IPAM Plugin deployment.<br> - Added support for CRDs upgrade during NVIDIA Network Operator installation or upgrade.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>23.4.0</td> <td> - Added support for Kubernetes &gt;= 1.21 and &lt;=1.27.<br> - Added support for NicClusterPolicy update and removal.<br> - Added support for OpenShift Container Platform 4.11 and 4.12.<br> <br> </td> </tr> <tr class=\"row-even\"><td>23.4.0</td> <td> - Added a calendar versioning schema for Network Operator releases to better align with the NVIDIA GPU Operator.<br> - Added support for the following operating systems and Kubernetes environments:<br> - RHEL 8.4 and 8.6 with CRI-O container runtime<br> - Kubernetes &gt;= 1.21 and &lt;=1.26<br> <br> - Added PKey configuration for IB networks with IB-Kubernetes.<br> - Added the ability to gracefully terminate the OFED container on DGX systems running Red Hat OpenShift.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.4.0</td> <td> - Added support for Kubernetes &gt;= 1.21 and &lt;=1.25.<br> - Added support for Ubuntu 22.04.<br> - Added support for OpenShift Container Platform 4.11 including DGX platform.<br> - Added Beta support for PKey configuration for IB networks with IB-Kubernetes.<br> <br> </td> </tr> <tr class=\"row-even\"><td>1.3.0</td> <td> - Added support for Kubernetes &gt;= 1.17 and &lt;=1.24.<br> - Added the option to use a single namespace to deploy Network Operator components.<br> - Added support for automatic MLNX OFED driver upgrade.<br> - Added support for IPoIB CNI.<br> - Added support for Air Gap deployment.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.2.0</td> <td> - Added support for OpenShift Container Platform 4.10.<br> - Added extended selectors support for SR-IOV Device Plugin resources with Helm chart.<br> - Added Whereabouts IP reconciler support.<br> - Added BlueField2 NICs support for SR-IOV operator.<br> <br> </td> </tr> <tr class=\"row-even\"><td>1.1.0</td> <td> - Added support for OpenShift Container Platform 4.9.<br> - Added support for Network Operator upgrade from v1.0.0.<br> - Added support for Kubernetes POD Security Policy.<br> - Added support for Kubernetes &gt;= 1.17 and &lt;=1.22.<br> - Added the ability to propagate nodeAffinity property from the NicClusterPolicy to Network Operator dependencies.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.0.0</td> <td> - Added Node Feature Discovery that can be used to mark nodes with NVIDIA SR-IOV NICs.<br> - Added support for different networking models:<br> - Macvlan Network<br> - HostDevice Network<br> - SR-IOV Network<br> <br> - Added Kubernetes cluster scale-up support.<br> - Published Network Operator image at NGC.<br> - Added support for Kubernetes &gt;= 1.17 and &lt;=1.21.<br> <br> </td> </tr> </tbody> </table> <h2 id=\"general_support\">General Support</h2> <h3 id=\"upgrade_notes\">Upgrade Notes</h3> <table> <colgroup> <col style=\"width: 12%\"> <col style=\"width: 88%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Version</p></th> <th class=\"head\"><p>Notes</p></th> </tr> <tr class=\"row-even\"><td>23.10.0</td> <td> - In NV-IPAM v0.1.1, the IP Pools configurations are read from IPPool CRs instead of using a ConfigMap. Existing ConfigMap configuration will be automatically migrated to IPPools CRs as part of the upgrade process.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>23.7.0</td> <td> - Dropped MLNX_OFED support for versions older than 5.7-0.1.2.0.<br> - Removed nv-peer-mem support in favor of nvidia-peer-mem.<br> <br> </td> </tr> <tr class=\"row-even\"><td>1.3.0</td> <td> - The option of manual gradual upgrade is not supported when upgrading to Network Operator v1.3.0, since all pods are dropped/restarted in case components are deployed into the single namespace when the old namespace is deleted. This could lead to networking connectivity issues during the upgrade procedure.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.2.0</td> <td> - Network Operator 1.2.0 deploys the NVIDIA MLNX_OFED 5.6 driver container by default. When deployed, depending on your system kernel and OS configuration, the network device name may change, as it no longer installs an udev rule to force network device naming scheme. Instead, the default setting uses the name already configured in the system by either <cite>systemd.network</cite> or any pre-existing udev rules (e.g <cite>enp3s0f0</cite> netdev will change to <cite>enp3s0f0np0</cite>). If that is the case in your system, please make sure to update the following:<br> - The <cite>master</cite> network device name in your MacvlanNetwork<br> - The <cite>ifNames</cite> selector, if used in RDMA shared device plugin resource configuration<br> - The <cite>pfNames</cite> selector, if used in SR-IOV device plugin configuration<br> - If the sriov-network-operator is used, any instance of <cite>SriovNetworkNodePolicy</cite> which utilizes <cite>NicSelector.PfNames</cite> field should be updated to the new network device name.<br> <br> - When Network Operator 1.2.0 is installed via Helm, it no longer deploys both RDMA shared device plugin and SR-IOV network device plugin by default, as it may cause the same device to be registered to two different device plugins. This is an undesirable behavior. Instead, by default, only RDMA shared device plugin is deployed via Helm.<br> If you wish to deploy both device plugins, set the <cite>sriovDevicePlugin.deploy</cite> Helm parameter to “true”.<br> <br> <br> </td> </tr> <tr class=\"row-even\"><td>1.1.0</td> <td>N/A</td> </tr> <tr class=\"row-odd\"><td>1.0.0</td> <td>N/A</td> </tr> </tbody> </table> <h3 id=\"bug_fixes\">Bug Fixes</h3> <table> <colgroup> <col style=\"width: 12%\"> <col style=\"width: 88%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Version</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>1.4.0</td> <td> - Fixed a cluster scale-up issue.<br> - Fixed an issue with IPoIB CNI deployment in OCP.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.3.0</td> <td> - N/A<br> <br> </td> </tr> <tr class=\"row-even\"><td>1.2.0</td> <td> - N/A<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.1.0</td> <td> - Fixed the Whereabouts IPAM plugin to work with Kubernetes v1.22.<br> - Fixed imagePullSecrets for Network Operator.<br> - Enabled resource names for HostDeviceNetwork to be accepted both with and without a prefix.<br> <br> </td> </tr> </tbody> </table> <h2 id=\"known_limitations\">Known Limitations</h2><table> <colgroup> <col style=\"width: 12%\"> <col style=\"width: 88%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Version</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>23.10.0</td> <td> - IPoIB sub-interface creation does not work on RHEL 8.8 and RHEL 9.2 due to the kernel limitations in these distributions. This means that IPoIBNetwork cannot be used with these operating systems.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>23.4.0</td> <td> - In case that the UNLOAD_STORAGE_MODULES parameter is enabled for MOFED container deployment, it is required to make sure that the relevant storage modules are not in use in the OS.<br> <br> </td> </tr> <tr class=\"row-even\"><td>23.1.0</td> <td> - Only a single PKey can be configured per IPoIB workload pod.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.4.0</td> <td> - The operator upgrade procedure does not reflect configuration changes. The RDMA Shared Device Plugin or SR-IOV Device Plugin should be restarted manually in case of configuration changes.<br> - The RDMA subsystem could be exclusive or shared only in one cluster. Mixed configuration is not supported. The RDMA Shared Device Plugin requires shared RDMA subsystem.<br> <br> </td> </tr> <tr class=\"row-even\"><td>1.3.0</td> <td> - MOFED container is not a supported configuration on the DGX platform.<br> - MOFED container deletion may lead to the driver’s unloading: In this case, the mlx5_core kernel driver must be reloaded manually. Network connectivity could be affected if there are only NVIDIA NICs on the node.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.2.0</td> <td> - N/A<br> <br> </td> </tr> <tr class=\"row-even\"><td>1.1.0</td> <td> - NicClusterPolicy update is not supported at the moment.<br> - Network Operator is compatible only with NVIDIA GPU Operator v1.9.0 and above.<br> - GPUDirect could have performance degradation if it is used with servers which are not optimized. Please see official GPUDirect documentation <a class=\"reference external\" href=\"https://docs.nvidia.com/cuda/gpudirect-rdma/index.html#supported-systems\" target=\"_self\">here</a>.<br> - Persistent NICs configuration for netplan or ifupdown scripts is required for SR-IOV and Shared RDMA interfaces on the host.<br> - POD Security Policy admission controller should be enabled to use PSP with Network Operator. Please see Deployment with Pod Security Policy in the Network Operator Documentation for details.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>1.0.0</td> <td> - Network Operator is only compatible with NVIDIA GPU Operator v1.5.2 and above.<br> - Persistent NICs configuration for netplan or ifupdown scripts is required for SR-IOV and Shared RDMA interfaces on the host.<br> <br> </td> </tr> </tbody> </table> </div></body></html>",
                "topicPages": [],
                "date": "08/08/2024"
            },
            {
                "title": "Getting Started with Kubernetes",
                "topicId": "getting_started_with_kubernetes",
                "figures": [],
                "copyright": "© Copyright 2024, NVIDIA.",
                "table": [],
                "body": "<html><head></head><body><div> <p class=\"topic-title\">On this page</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_guide\">Network Operator Deployment Guide</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_on_vanilla_kubernetes_cluster\">Network Operator Deployment on Vanilla Kubernetes Cluster</a></p></li> <li class=\"has-marker\"><p><a href=\"#deployment_examples\">Deployment Examples</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_rdma_shared_device_plugin\">Network Operator Deployment with RDMA Shared Device Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_multiple_resources_in_rdma_shared_device_plugin\">Network Operator Deployment with Multiple Resources in RDMA Shared Device Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_a_secondary_network\">Network Operator Deployment with a Secondary Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_nvidia_ipam\">Network Operator Deployment with NVIDIA-IPAM</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_a_host_device_network\">Network Operator Deployment with a Host Device Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_a_host_device_network_and_macvlan_network\">Network Operator Deployment with a Host Device Network and Macvlan Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_an_ip_over_infiniband_ipoib_network\">Network Operator Deployment with an IP over InfiniBand (IPoIB) Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_for_gpudirect_workloads\">Network Operator Deployment for GPUDirect Workloads</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_in_sr_iov_legacy_mode\">Network Operator Deployment in SR-IOV Legacy Mode</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_operator_deployment_parallel_node_configuration_for_sr_iov\">SR-IOV Network Operator Deployment – Parallel Node Configuration for SR-IOV</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#upgrade_from_nvidia_network_operator_v24_1_0\">Upgrade from NVIDIA Network Operator v24.1.0</a></p></li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_operator_deployment_parallel_nic_configuration_for_sr_iov\">SR-IOV Network Operator Deployment – Parallel NIC Configuration for SR-IOV</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_operator_deployment_sr_iov_using_the_systemd_service\">SR-IOV Network Operator Deployment – SR-IOV Using the systemd Service</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_an_sr_iov_infiniband_network\">Network Operator Deployment with an SR-IOV InfiniBand Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_an_sr_iov_infiniband_network_with_pkey_management\">Network Operator Deployment with an SR-IOV InfiniBand Network with PKey Management</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_for_dpdk_workloads_with_nicclusterpolicy\">Network Operator Deployment for DPDK Workloads with NicClusterPolicy</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_and_openvswitch_offload\">Network Operator Deployment and OpenvSwitch offload</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#network_operator_configuration\">Network Operator Configuration</a></p></li> <li class=\"has-marker\"><p><a href=\"#prerequisites_for_worker_nodes\">Prerequisites for Worker Nodes</a></p></li> <li class=\"has-marker\"><p><a href=\"#ovs_kernel\">OVS-kernel</a></p></li> <li class=\"has-marker\"><p><a href=\"#ovs_doca\">OVS-doca</a></p></li> <li class=\"has-marker\"><p><a href=\"#test_workload\">Test Workload</a></p></li> <li class=\"has-marker\"><p><a href=\"#troubleshooting_ovs\">Troubleshooting OVS</a></p></li> </ul> </li> </ul> </li> </ul> <br><h2 id=\"network_operator_deployment_guide\">Network Operator Deployment Guide</h2><div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The Network Operator Release Notes chapter is available <a href=\"https://docs.nvidia.com/./release-notes.html\">here</a>.</p> </div></div> <p>NVIDIA Network Operator leverages <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/\" target=\"_self\">Kubernetes CRDs</a> and <a class=\"reference external\" href=\"https://github.com/operator-framework/operator-sdk\" target=\"_self\">Operator SDK</a> to manage networking related components in order to enable fast networking, RDMA and GPUDirect for workloads in a Kubernetes cluster. The Network Operator works in conjunction with the <a class=\"reference external\" href=\"https://github.com/NVIDIA/gpu-operator\" target=\"_self\">GPU-Operator</a> to enable GPU-Direct RDMA on compatible systems.</p> <p>The goal of the Network Operator is to manage the networking related components, while enabling execution of RDMA and GPUDirect RDMA workloads in a Kubernetes cluster. This includes:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>NVIDIA Networking drivers to enable advanced features - enp1 netdcreate, an NV-IPAM IPPool</p></li> <li class=\"has-marker\"><p>Kubernetes device plugins to provide hardware resources required for an accelerated network</p></li> <li class=\"has-marker\"><p>Kubernetes secondary network components for network intensive workloads</p></li> </ul> <h2 id=\"network_operator_deployment_on_vanilla_kubernetes_cluster\">Network Operator Deployment on Vanilla Kubernetes Cluster</h2><div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>It is recommended to have dedicated control plane nodes for Vanilla Kubernetes deployments with NVIDIA Network Operator.</p> </div></div> <p>The default installation via Helm as described below will deploy the Network Operator and related CRDs, after which an additional step is required to create a NicClusterPolicy custom resource with the configuration that is desired for the cluster.</p> <p>For more information on NicClusterPolicy custom resource, please refer to the <a class=\"reference external\" href=\"https://github.com/Mellanox/network-operator#nicclusterpolicy-crd\" target=\"_self\">Network-Operator Project Sources</a>.</p> <p>The provided Helm chart contains various parameters to facilitate the creation of a NicClusterPolicy custom resource upon deployment.</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Each Network Operator Release has a set of default version values for the various components it deploys. It is recommended that these values will not be changed. Testing and validation were performed with these values, and there is no guarantee of interoperability nor correctness when different versions are used.</p> </div></div> <i class=\"caption-text\">Add NVIDIA NGC Helm repository</i><br> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">helm repo add nvidia https://helm.ngc.nvidia.com/nvidia</div></pre></div> <br> <i class=\"caption-text\">Update helm repositories</i><br> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">helm repo update</div></pre></div> <br> <p>Install Network Operator from the NVIDIA NGC chart using the default values:</p> helm install network-operator nvidia/network-operator   -n nvidia-network-operator   --create-namespace   --version v24.4.0   --wait <i class=\"caption-text\">View deployed resources</i><br> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl -n nvidia-network-operator get pods</div></pre></div> <br> <p>Install the Network Operator from the NVIDIA NGC chart using custom values:</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Since several parameters should be provided when creating custom resources during operator deployment, it is recommended to use a configuration file. While it is possible to override the parameters via CLI, we recommend to avoid the use of CLI arguments in favor of a configuration file.</p> </div></div> helm show values nvidia/network-operator --version v24.4.0 &gt; values.yaml helm install network-operator nvidia/network-operator   -n nvidia-network-operator   --create-namespace   --version v24.4.0   -f ./values.yaml   --wait <h2 id=\"deployment_examples\">Deployment Examples</h2><div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Since several parameters should be provided when creating custom resources during operator deployment, it is recommended to use a configuration file. While it is possible to override the parameters via CLI, we recommend to avoid the use of CLI arguments in favor of a configuration file.</p> </div></div> <p>Below are deployment examples, which the <bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline> file provided to the Helm during the installation of the network operator. This was achieved by running:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">helm install -f ./values.yaml -n nvidia-network-operator --create-namespace --wait nvidia/network-operator network-operator</div></pre></div> <h3 id=\"network_operator_deployment_with_rdma_shared_device_plugin\">Network Operator Deployment with RDMA Shared Device Plugin</h3> <p>Network operator deployment with the default version of the OFED driver and a single RDMA resource mapped to ens1f0 netdev.:</p> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ens1f0<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_with_multiple_resources_in_rdma_shared_device_plugin\">Network Operator Deployment with Multiple Resources in RDMA Shared Device Plugin</h3> <p>Network Operator deployment with the default version of OFED and an RDMA device plugin with two RDMA resources. The first is mapped to ens1f0 and ens1f1, and the second is mapped to ens2f0 and ens2f1.</p> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ens1f0<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>ens1f1<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_b<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ens2f0<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>ens2f1<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_with_a_secondary_network\">Network Operator Deployment with a Secondary Network</h3> <p>Network Operator deployment with:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>RDMA shared device plugin</p></li> <li class=\"has-marker\"><p>Secondary network</p></li> <li class=\"has-marker\"><p>Mutlus CNI</p></li> <li class=\"has-marker\"><p>Container-networking-plugins CNI plugins</p></li> <li class=\"has-marker\"><p>Whereabouts IPAM CNI Plugin</p></li> </ul> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline>:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ens1f0<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_with_nvidia_ipam\">Network Operator Deployment with NVIDIA-IPAM</h3> <p>Network Operator deployment with:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>RDMA shared device plugin</p></li> <li class=\"has-marker\"><p>Secondary network</p></li> <li class=\"has-marker\"><p>Multus CNI</p></li> <li class=\"has-marker\"><p>Container-networking-plugins</p></li> <li class=\"has-marker\"><p>CNI plugins</p></li> <li class=\"has-marker\"><p>NVIDIA-IPAM CNI Plugin</p></li> </ul> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline>:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ens1f0<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">nvIpam<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>To create an NV-IPAM IPPool, apply:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>nv-ipam.nvidia.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>IPPool<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>my-pool<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>subnet<span class=\"p\">:</span><span class=\"w\"> </span>192.168.0.0/24<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>perNodeBlockSize<span class=\"p\">:</span><span class=\"w\"> </span>100<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>gateway<span class=\"p\">:</span><span class=\"w\"> </span>192.168.0.1<span class=\"w\"></span></div></pre></div> <p>Example of a MacvlanNetwork that uses NVIDIA-IPAM:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>MacvlanNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>example-macvlannetwork<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>master<span class=\"p\">:</span><span class=\"w\"> </span>\"ens2f0\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mode<span class=\"p\">:</span><span class=\"w\"> </span>\"bridge\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"nv-ipam\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"poolName\": \"my-pool\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_with_a_host_device_network\">Network Operator Deployment with a Host Device Network</h3> <p>Network Operator deployment with:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>SR-IOV device plugin, single SR-IOV resource pool</p></li> <li class=\"has-marker\"><p>Secondary network</p></li> <li class=\"has-marker\"><p>Multus CNI</p></li> <li class=\"has-marker\"><p>Container-networking-plugins CNI plugins</p></li> <li class=\"has-marker\"><p>Whereabouts IPAM CNI plugin</p></li> </ul> <p>In this mode, the Network Operator could be deployed on virtualized deployments as well. It supports both Ethernet and InfiniBand modes. From the Network Operator perspective, there is no difference between the deployment procedures. To work on a VM (virtual machine), the PCI passthrough must be configured for SR-IOV devices. The Network Operator works both with VF (Virtual Function) and PF (Physical Function) inside the VMs.</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>If the Host Device Network is used without the MLNX_OFED driver, the following packages should be installed:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>the linux-generic package on Ubuntu hosts</p></li> <li class=\"has-marker\"><p>the kernel-modules-extra package on the RedHat-based hosts</p></li> </ul> </div></div> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline>:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>Following the deployment, the network operator should be configured, and K8s networking should be deployed to use it in pod configuration.</p> <p>The <bsp-code-inline code=\"host-device-net.yaml\">host-device-net.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>HostDeviceNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"nvidia.com/hostdev\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.3.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>],<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\": \"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\": \"info\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p>The <bsp-code-inline code=\"host-device-net-ocp.yaml\">host-device-net-ocp.yaml</bsp-code-inline> configuration file for such a deployment in the OpenShift Platform:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>HostDeviceNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"nvidia.com/hostdev\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.3.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>]<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p>The <bsp-code-inline code=\"pod.yaml\">pod.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-test-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>restartPolicy<span class=\"p\">:</span><span class=\"w\"> </span>OnFailure<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>image<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>name<span class=\"p\">:</span><span class=\"w\"> </span>mofed-test-ctr<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"IPC_LOCK\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/hostdev<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/hostdev<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_with_a_host_device_network_and_macvlan_network\">Network Operator Deployment with a Host Device Network and Macvlan Network</h3> <p>In this combined deployment, different NVIDIA NICs are used for RDMA Shared Device Plugin and SR-IOV Network Device Plugin in order to work with a Host Device Network or a Macvlan Network on different NICs. It is impossible to combine different networking types on the same NICs. The same principle should be applied for other networking combinations.</p> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline>:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>linkTypes<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ether<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>linkTypes<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>“infiniband”<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>For pods and network configuration examples please refer to the corresponding sections: Network Operator Deployment with the RDMA Shared Device Plugin and Network Operator Deployment with a Host Device Network.</p> <h3 id=\"network_operator_deployment_with_an_ip_over_infiniband_ipoib_network\">Network Operator Deployment with an IP over InfiniBand (IPoIB) Network</h3> <p>Network Operator deployment with:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>RDMA shared device plugin</p></li> <li class=\"has-marker\"><p>Secondary network</p></li> <li class=\"has-marker\"><p>Multus CNI</p></li> <li class=\"has-marker\"><p>IPoIB CNI</p></li> <li class=\"has-marker\"><p>Whereabouts IPAM CNI plugin</p></li> </ul> <p>In this mode, the Network Operator could be deployed on virtualized deployments as well. It supports both Ethernet and InfiniBand modes. From the Network Operator perspective, there is no difference between the deployment procedures. To work on a VM (virtual machine), the PCI passthrough must be configured for SR-IOV devices. The Network Operator works both with VF (Virtual Function) and PF (Physical Function) inside the VMs.</p> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline>:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ibs1f0<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipoib<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>Following the deployment, the network operator should be configured, and K8s networking deployed to use it in the pod configuration.</p> <p>The <bsp-code-inline code=\"ipoib-net.yaml\">ipoib-net.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>IPoIBNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>example-ipoibnetwork<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>master<span class=\"p\">:</span><span class=\"w\"> </span>\"ibs1f0\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.5.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.6.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.6.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>],<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\" : \"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\" : \"info\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"gateway\": \"192.168.6.1\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p>The <bsp-code-inline code=\"ipoib-net-ocp.yaml\">ipoib-net-ocp.yaml</bsp-code-inline> configuration file for such a deployment in the OpenShift Platform:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>IPoIBNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>example-ipoibnetwork<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>master<span class=\"p\">:</span><span class=\"w\"> </span>\"ibs1f0\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.5.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.6.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.6.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>]<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p>The <bsp-code-inline code=\"pod.yaml\">pod.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>iboip-test-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>example-ipoibnetwork<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>restartPolicy<span class=\"p\">:</span><span class=\"w\"> </span>OnFailure<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>image<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>name<span class=\"p\">:</span><span class=\"w\"> </span>mofed-test-ctr<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"IPC_LOCK\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>rdma/rdma_shared_device_a<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>edma/rdma_shared_device_a<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_for_gpudirect_workloads\">Network Operator Deployment for GPUDirect Workloads</h3> <p>GPUDirect requires the following:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>MLNX_OFED v5.5-1.0.3.2 or newer</p></li> <li class=\"has-marker\"><p>GPU Operator v1.9.0 or newer</p></li> <li class=\"has-marker\"><p>NVIDIA GPU and driver supporting GPUDirect e.g Quadro RTX 6000/8000 or NVIDIA T4/NVIDIA V100/NVIDIA A100</p></li> </ul> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline> example:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"host-device-net.yaml:\">host-device-net.yaml:</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>HostDeviceNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">   </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdevice-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"hostdev\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.3.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>],<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\" : \"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\" : \"info\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p>The <bsp-code-inline code=\"host-device-net-ocp.yaml\">host-device-net-ocp.yaml</bsp-code-inline> configuration file for such a deployment in the OpenShift Platform:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>HostDeviceNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">   </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdevice-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"hostdev\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.3.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>]<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"host-net-gpudirect-pod.yaml\">host-net-gpudirect-pod.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>testpod1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">     </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>hostdevice-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>appcntr1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>image<span class=\"p\">:</span><span class=\"w\"> </span>&lt;image&gt;<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>IfNotPresent<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"IPC_LOCK\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/hostdev<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/gpu<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/hostdev<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/gpu<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_in_sr_iov_legacy_mode\">Network Operator Deployment in SR-IOV Legacy Mode</h3> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The SR-IOV Network Operator will be deployed with the default configuration. You can override these settings using a CLI argument, or the ‘sriov-network-operator’ section in the values.yaml file. For more information, refer to the <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/sriov-network-operator/\" target=\"_self\">Project Documentation</a>.</p> </div></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>This deployment mode supports SR-IOV in legacy mode.</p> </div></div> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline> configuration for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>Following the deployment, the Network Operator should be configured, and sriovnetwork node policy and K8s networking should be deployed.</p> <p>The <bsp-code-inline code=\"sriovnetwork-node-policy.yaml\">sriovnetwork-node-policy.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkNodePolicy<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>policy-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceType<span class=\"p\">:</span><span class=\"w\"> </span>netdevice<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nicSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>\"15b3\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>pfNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"ens2f0\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>feature.node.kubernetes.io/pci-15b3.present<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>numVfs<span class=\"p\">:</span><span class=\"w\"> </span>8<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>priority<span class=\"p\">:</span><span class=\"w\"> </span>90<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>isRdma<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>sriov_resource<span class=\"w\"></span></div></pre></div> <p>The <bsp-code-inline code=\"sriovnetwork.yaml\">sriovnetwork.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>\"example-sriov-network\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vlan<span class=\"p\">:</span><span class=\"w\"> </span>0<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"sriov_resource\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|-</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\": \"/tmp/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\": \"debug\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.101.0/24\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The ens2f0 network interface name has been chosen from the following command output: <bsp-code-inline code=\"kubectl -n nvidia-network-operator get sriovnetworknodestates.sriovnetwork.openshift.io -o yaml\"> kubectl -n nvidia-network-operator get sriovnetworknodestates.sriovnetwork.openshift.io -o yaml </bsp-code-inline>.</p> </div></div> <div class=\"code-body \"><pre><div class=\"code-line\">...<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">status<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>interfaces<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>deviceID<span class=\"p\">:</span><span class=\"w\"> </span>101d<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>driver<span class=\"p\">:</span><span class=\"w\"> </span>mlx5_core<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>linkSpeed<span class=\"p\">:</span><span class=\"w\"> </span>100000 Mb/s<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>linkType<span class=\"p\">:</span><span class=\"w\"> </span>ETH<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>mac<span class=\"p\">:</span><span class=\"w\"> </span>0c:42:a1:2b:74:ae<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ens2f0<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>pciAddress<span class=\"p\">:</span><span class=\"w\"> </span>\"0000:07:00.0\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>totalvfs<span class=\"p\">:</span><span class=\"w\"> </span>8<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>15b3<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>deviceID<span class=\"p\">:</span><span class=\"w\"> </span>101d<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>driver<span class=\"p\">:</span><span class=\"w\"> </span>mlx5_core<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>linkType<span class=\"p\">:</span><span class=\"w\"> </span>ETH<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>mac<span class=\"p\">:</span><span class=\"w\"> </span>0c:42:a1:2b:74:af<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ens2f1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>pciAddress<span class=\"p\">:</span><span class=\"w\"> </span>\"0000:07:00.1\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>totalvfs<span class=\"p\">:</span><span class=\"w\"> </span>8<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>15b3<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">...<span class=\"w\"></span></div></pre></div> <p>Wait for all required pods to be spawned:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\"><i># kubectl get pod -n nvidia-network-operator | grep sriov</i></div><div class=\"code-line\">network-operator-sriov-network-operator-544c8dbbb9-vzkmc          1/1     Running   0          5d</div><div class=\"code-line\">sriov-device-plugin-vwpzn                                         1/1     Running   0          2d6h</div><div class=\"code-line\">sriov-network-config-daemon-qv467                                 3/3     Running   0          5d</div><div class=\"code-line\"><i># kubectl get pod -n nvidia-network-operator</i></div><div class=\"code-line\">NAME                                            READY   STATUS    RESTARTS   AGE</div><div class=\"code-line\">cni-plugins-ds-kbvnm                            1/1     Running   0          5d</div><div class=\"code-line\">cni-plugins-ds-pcllg                            1/1     Running   0          5d</div><div class=\"code-line\">kube-multus-ds-5j6ns                            1/1     Running   0          5d</div><div class=\"code-line\">kube-multus-ds-mxgvl                            1/1     Running   0          5d</div><div class=\"code-line\">mofed-ubuntu20.04-ds-2zzf4                      1/1     Running   0          5d</div><div class=\"code-line\">mofed-ubuntu20.04-ds-rfnsw                      1/1     Running   0          5d</div><div class=\"code-line\">whereabouts-nw7hn                               1/1     Running   0          5d</div><div class=\"code-line\">whereabouts-zvhrv                               1/1     Running   0          5d</div><div class=\"code-line\">...</div></pre></div> <p>The <bsp-code-inline code=\"pod.yaml\">pod.yaml</bsp-code-inline> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>testpod1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>example-sriov-network<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>appcntr1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>image<span class=\"p\">:</span><span class=\"w\"> </span>&lt;image&gt;<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>IfNotPresent<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"IPC_LOCK\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/sriov_resource<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/sriov_resource<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div></pre></div> <h3 id=\"sr_iov_network_operator_deployment_parallel_node_configuration_for_sr_iov\">SR-IOV Network Operator Deployment – Parallel Node Configuration for SR-IOV</h3> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>This feature is supported only for Vanilla Kubernetes deployments with SR-IOV Network Operator.</p> </div></div> <p>To apply SR-IOV configuration on several nodes in parallel, create a <bsp-code-inline code=\"SriovNetworkPoolConfig\">SriovNetworkPoolConfig</bsp-code-inline> CR and specify the maximum number or percentage of nodes that can be unavailable at the same time:</p> <p><bsp-code-inline code=\"sriov-network-pool-config-number.yaml\">sriov-network-pool-config-number.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkPoolConfig<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>pool-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>maxUnavailable<span class=\"p\">:</span><span class=\"w\"> </span>\"20\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>matchExpressions<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>key<span class=\"p\">:</span><span class=\"w\"> </span>some-label<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>operator<span class=\"p\">:</span><span class=\"w\"> </span>In<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>values<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>val-2<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>matchExpressions<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>key<span class=\"p\">:</span><span class=\"w\"> </span>other-label<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>operator<span class=\"p\">:</span><span class=\"w\"> </span>\"Exists\"<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"sriov-network-pool-config-percent.yaml\">sriov-network-pool-config-percent.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkPoolConfig<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>pool-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>maxUnavailable<span class=\"p\">:</span><span class=\"w\"> </span>\"10%\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>matchExpressions<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>key<span class=\"p\">:</span><span class=\"w\"> </span>some-label<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>operator<span class=\"p\">:</span><span class=\"w\"> </span>In<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>values<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>val-2<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>matchExpressions<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>key<span class=\"p\">:</span><span class=\"w\"> </span>other-label<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>operator<span class=\"p\">:</span><span class=\"w\"> </span>\"Exists\"<span class=\"w\"></span></div></pre></div> <h4 id=\"upgrade_from_nvidia_network_operator_v24_1_0\">Upgrade from NVIDIA Network Operator v24.1.0</h4> <p>To upgrade SR-IOV Network operator you need to create <bsp-code-inline code=\"SriovNetworkPoolConfig\">SriovNetworkPoolConfig</bsp-code-inline> CR with the number of nodes to be configured in a parallel as we did in <cite>SriovOperatorConfig`</cite> in previous releases.</p> <p>E.g.: old method to configure nodes in a parallel:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl patch sriovoperatorconfigs.sriovnetwork.openshift.io -n network-operator default --patch '{ \"spec\": { \"maxParallelNodeConfiguration\": 5 } }' --type='merge'</div></pre></div> <p>New  method to configure nodes in a parallel:</p> <p><bsp-code-inline code=\"sriov-network-pool-config-new.yaml\">sriov-network-pool-config-new.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkPoolConfig<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>pool-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>maxUnavailable<span class=\"p\">:</span><span class=\"w\"> </span>\"5\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>matchExpressions<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>key<span class=\"p\">:</span><span class=\"w\"> </span>node-role.kubernetes.io/master<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>operator<span class=\"p p-Indicator\">:</span><span class=\"w\"> </span>Exists<span class=\"w\"></span></div></pre></div> <h3 id=\"sr_iov_network_operator_deployment_parallel_nic_configuration_for_sr_iov\">SR-IOV Network Operator Deployment – Parallel NIC Configuration for SR-IOV</h3> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>This feature is supported only for Vanilla Kubernetes deployments with SR-IOV Network Operator.</p> </div></div> <p>To apply SriovNetworkNodePolicy on several nodes in parallel, specify the <bsp-code-inline code=\"featureGates\">featureGates</bsp-code-inline> option in the SriovOperatorConfig CRD:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl patch sriovoperatorconfigs.sriovnetwork.openshift.io -n network-operator default --patch '{ \"spec\": { \"featureGates\": { \"parallelNicConfig\": true  } } }' --type='merge'</div></pre></div> <h3 id=\"sr_iov_network_operator_deployment_sr_iov_using_the_systemd_service\">SR-IOV Network Operator Deployment – SR-IOV Using the systemd Service</h3> <p>To enable systemd SR-IOV configuration mode, specify the configurationMode option in the SriovOperatorConfig CRD:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl patch sriovoperatorconfigs.sriovnetwork.openshift.io -n network-operator default --patch '{ \"spec\": { \"configurationMode\": \"systemd\"} }' --type='merge'</div></pre></div> <h3 id=\"network_operator_deployment_with_an_sr_iov_infiniband_network\">Network Operator Deployment with an SR-IOV InfiniBand Network</h3> <p>Network Operator deployment with InfiniBand network requires the following:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>MLNX_OFED and OpenSM running. OpenSM runs on top of the MLNX_OFED stack, so both the driver and the subnet manager should come from the same installation. Note that partitions that are configured by OpenSM should specify defmember=full to enable the SR-IOV functionality over InfiniBand. For more details, please refer to <cite>this article &lt;https://docs.mellanox.com/display/MLNXOFEDv51258060/OpenSM&gt;</cite>.</p></li> <li class=\"has-marker\"><p>InfiniBand device – Both the host device and switch ports must be enabled in InfiniBand mode.</p></li> <li class=\"has-marker\"><p>rdma-core package should be installed when an inbox driver is used.</p></li> </ul> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"sriov-ib-network-node-policy.yaml\">sriov-ib-network-node-policy.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkNodePolicy<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>infiniband-sriov<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceType<span class=\"p\">:</span><span class=\"w\"> </span>netdevice<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>feature.node.kubernetes.io/pci-15b3.present<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nicSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>\"15b3\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkType<span class=\"p\">:</span><span class=\"w\"> </span>infiniband<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>isRdma<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>numVfs<span class=\"p\">:</span><span class=\"w\"> </span>8<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>priority<span class=\"p\">:</span><span class=\"w\"> </span>90<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>mlnxnics<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"sriov-ib-network.yaml\">sriov-ib-network.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovIBNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>example-sriov-ib-network<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.5.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.5.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.5.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>],<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\": \"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\": \"info\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>mlnxnics<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkState<span class=\"p\">:</span><span class=\"w\"> </span>enable<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>default<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"sriov-ib-network-pod.yaml\">sriov-ib-network-pod.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>test-sriov-ib-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>example-sriov-ib-network<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>test-sriov-ib-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>image<span class=\"p\">:</span><span class=\"w\"> </span>centos/tools<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>IfNotPresent<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"IPC_LOCK\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>nvidia.com/mlnxics<span class=\"p\">:</span><span class=\"w\"> </span>\"1\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>nvidia.com/mlnxics<span class=\"p\">:</span><span class=\"w\"> </span>\"1\"<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_with_an_sr_iov_infiniband_network_with_pkey_management\">Network Operator Deployment with an SR-IOV InfiniBand Network with PKey Management</h3> <p>Network Operator deployment with InfiniBand network requires the following:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>MLNX_OFED and OpenSM running. OpenSM runs on top of the MLNX_OFED stack, so both the driver and the subnet manager should come from the same installation. Note that partitions that are configured by OpenSM should specify defmember=full to enable the SR-IOV functionality over InfiniBand. For more details, please refer to <a class=\"reference external\" href=\"https://docs.mellanox.com/display/MLNXOFEDv51258060/OpenSM\" target=\"_self\">this article</a>.</p></li> <li class=\"has-marker\"><p>NVIDIA UFM running on top of OpenSM. For more details, please refer to <a class=\"reference external\" href=\"https://docs.nvidia.com/networking/display/UFMEnterpriseUMv652\" target=\"_self\">the project documentation</a>.</p></li> <li class=\"has-marker\"><p>InfiniBand device – Both the host device and the switch ports must be enabled in InfiniBand mode.</p></li> <li class=\"has-marker\"><p>rdma-core package should be installed when an inbox driver is used.</p></li> </ul> <p>Current limitations:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>Only a single PKey can be configured per workload pod.</p></li> <li class=\"has-marker\"><p>When a single instance of NVIDIA UFM is used with several K8s clusters, different PKey GUID pools should be configured for each cluster.</p></li> </ul> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p><cite>ib-kubernetes-ufm-secret</cite> should be created before NicClusterPolicy.</p> </div></div> <p><bsp-code-inline code=\"ufm-secret.yaml\">ufm-secret.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Secret<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ib-kubernetes-ufm-secret<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">stringData<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_USERNAME<span class=\"p\">:</span><span class=\"w\"> </span>\"admin\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_PASSWORD<span class=\"p\">:</span><span class=\"w\"> </span>\"123456\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_ADDRESS<span class=\"p\">:</span><span class=\"w\"> </span>\"ufm-host\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_HTTP_SCHEMA<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_PORT<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\">data<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_CERTIFICATE<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">nfd<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourcePrefix<span class=\"p\">:</span><span class=\"w\"> </span>\"nvidia.com\"<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\"><i># NicClusterPolicy CR values:</i><span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">rdmaSharedDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\">sriovDevicePlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>false<span class=\"w\"></span></div><div class=\"code-line\">ibKubernetes<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>periodicUpdateSeconds<span class=\"p\">:</span><span class=\"w\"> </span>5<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>pKeyGUIDPoolRangeStart<span class=\"p\">:</span><span class=\"w\"> </span>\"02:00:00:00:00:00:00:00\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>pKeyGUIDPoolRangeEnd<span class=\"p\">:</span><span class=\"w\"> </span>\"02:FF:FF:FF:FF:FF:FF:FF\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ufmSecret<span class=\"p\">:</span><span class=\"w\"> </span>ufm-secret<span class=\"w\"></span></div><div class=\"code-line\"></div><div class=\"code-line\">secondaryNetwork<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>multus<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>cniPlugins<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipamPlugin<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>Wait for MLNX_OFED to install and apply the following CRs:</p> <p><bsp-code-inline code=\"sriov-ib-network-node-policy.yaml\">sriov-ib-network-node-policy.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkNodePolicy<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>infiniband-sriov<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceType<span class=\"p\">:</span><span class=\"w\"> </span>netdevice<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>feature.node.kubernetes.io/pci-15b3.present<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nicSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>\"15b3\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkType<span class=\"p\">:</span><span class=\"w\"> </span>ib<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>isRdma<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>numVfs<span class=\"p\">:</span><span class=\"w\"> </span>8<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>priority<span class=\"p\">:</span><span class=\"w\"> </span>90<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>mlnxnics<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"sriov-ib-network.yaml\">sriov-ib-network.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>\"k8s.cni.cncf.io/v1\"<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>NetworkAttachmentDefinition<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ib-sriov-network<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/resourceName<span class=\"p\">:</span><span class=\"w\"> </span>nvidia.com/mlnxnics<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>config<span class=\"p\">:</span><span class=\"w\"> </span>'{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"type\":\"ib-sriov\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"cniVersion\":\"0.3.1\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"name\":\"ib-sriov-network\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"pkey\":\"0x6\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"link_state\":\"enable\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"ibKubernetesEnabled\":true,<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>\"ipam\":{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\":\"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\":\"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\":{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\":\"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\":\"10.56.217.0/24\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\":\"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\":\"info\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div><div class=\"code-line\">}'<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"sriov-ib-network-pod.yaml\">sriov-ib-network-pod.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>test-sriov-ib-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>ib-sriob-network<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>test-sriov-ib-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>image<span class=\"p\">:</span><span class=\"w\"> </span>centos/tools<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>IfNotPresent<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"IPC_LOCK\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>nvidia.com/mlnxics<span class=\"p\">:</span><span class=\"w\"> </span>\"1\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>nvidia.com/mlnxics<span class=\"p\">:</span><span class=\"w\"> </span>\"1\"<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_for_dpdk_workloads_with_nicclusterpolicy\">Network Operator Deployment for DPDK Workloads with NicClusterPolicy</h3> <p>This deployment mode supports DPDK applications. In order to run DPDK applications, <a class=\"reference external\" href=\"http://manpages.ubuntu.com/manpages/focal/man8/hugeadm.8.html\" target=\"_self\">HUGEPAGE</a> should be configured on the required K8s Worker Nodes. By default, the inbox operating system driver is used. For support of cases with specific requirements, OFED container should be deployed.</p> <p>Network Operator deployment with:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>Host Device Network</p></li> <li class=\"has-marker\"><p>DPDK pod</p></li> </ul> <p><bsp-code-inline code=\"nicclusterpolicy.yaml\">nicclusterpolicy.yaml</bsp-code-inline></p> apiVersion: mellanox.com/v1alpha1 kind: NicClusterPolicy metadata: name: nic-cluster-policy spec: ofedDriver: image: doca-driver repository: nvcr.io/nvidia/mellanox version: 24.04-0.6.6.0-0 sriovDevicePlugin: image: sriov-network-device-plugin repository: ghcr.io/k8snetworkplumbingwg version: e6ead1e8f76a407783430ee2666b403db2d76f64 config: | { \"resourceList\": [ { \"resourcePrefix\": \"nvidia.com\", \"resourceName\": \"rdma_host_dev\", \"selectors\": { \"vendors\": [\"15b3\"], \"devices\": [\"1018\"], \"drivers\": [\"mlx5_core\"] } } ] } secondaryNetwork: cniPlugins: image: plugins repository: ghcr.io/k8snetworkplumbingwg version: v1.3.0-amd64 ipamPlugin: image: whereabouts repository: ghcr.io/k8snetworkplumbingwg version: v0.7.0-amd64 multus: image: multus-cni repository: ghcr.io/k8snetworkplumbingwg version: v3.9.3 <p><bsp-code-inline code=\"host-device-net.yaml\">host-device-net.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>HostDeviceNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>example-hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"rdma_host_dev\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.3.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>],<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\" : \"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\" : \"info\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p><bsp-code-inline code=\"pod.yaml\">pod.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>testpod1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>example-hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>appcntr1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>image<span class=\"p\">:</span><span class=\"w\"> </span>&lt;dpdk image&gt;<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>IfNotPresent<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"IPC_LOCK\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>volumeMounts<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>mountPath<span class=\"p\">:</span><span class=\"w\"> </span>/dev/hugepages<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hugepage<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>memory<span class=\"p\">:</span><span class=\"w\"> </span>1Gi<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>hugepages-1Gi<span class=\"p\">:</span><span class=\"w\"> </span>2Gi<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/rdma_host_dev<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"/bin/bash\"<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>\"-c\"<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>\"--\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>args<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"whiletrue;dosleep300000;done;\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>volumes<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">   </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hugepage<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">     </span>emptyDir<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>medium<span class=\"p\">:</span><span class=\"w\"> </span>HugePages<span class=\"w\"></span></div></pre></div> <h3 id=\"network_operator_deployment_and_openvswitch_offload\">Network Operator Deployment and OpenvSwitch offload</h3> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>This feature is supported only for Vanilla Kubernetes deployments with SR-IOV Network Operator.</p> </div></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>This mode of operation is not compatible with OFED container.</p> </div></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Tech Preview feature.</p> </div></div> <h4 id=\"network_operator_configuration\">Network Operator Configuration</h4> <p>Deploy network-operator by Helm with sriov-network-operator and nv-ipam.</p> <p><bsp-code-inline code=\"values.yaml\">values.yaml</bsp-code-inline></p> <div class=\"code-body \"><pre><div class=\"code-line\">sriovNetworkOperator<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>enabled<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">deployCR<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\">nvIpam<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deploy<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div></pre></div> <p>Enable <bsp-code-inline code=\"manageSoftwareBridges\">manageSoftwareBridges</bsp-code-inline> featureGate for sriov-network-operator</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl patch sriovoperatorconfigs.sriovnetwork.openshift.io -n network-operator default --patch '{ \"spec\": { \"featureGates\": { \"manageSoftwareBridges\": true  } } }' --type='merge'</div></pre></div> <p>Create IPPool object for nv-ipam</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>nv-ipam.nvidia.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>IPPool<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>pool1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>subnet<span class=\"p\">:</span><span class=\"w\"> </span>192.168.0.0/16<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>perNodeBlockSize<span class=\"p\">:</span><span class=\"w\"> </span>100<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>gateway<span class=\"p\">:</span><span class=\"w\"> </span>192.168.0.1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>nodeSelectorTerms<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>matchExpressions<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>key<span class=\"p\">:</span><span class=\"w\"> </span>node-role.kubernetes.io/worker<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>operator<span class=\"p\">:</span><span class=\"w\"> </span>Exists<span class=\"w\"></span></div></pre></div> <h4 id=\"prerequisites_for_worker_nodes\">Prerequisites for Worker Nodes</h4> <p>Supported operating systems:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>Ubuntu 22.04</p></li> </ul> <p>OpenvSwitch from the <bsp-code-inline code=\"NVIDIA DOCA for Host\">NVIDIA DOCA for Host</bsp-code-inline> package with <bsp-code-inline code=\"doca-all\">doca-all</bsp-code-inline> or <bsp-code-inline code=\"doca-networking\">doca-networking</bsp-code-inline> profile should be installed on each worker node.</p> <p>Check NVIDIA DOCA <a class=\"reference external\" href=\"https://docs.nvidia.com/doca/sdk/nvidia+doca+installation+guide+for+linux/index.html\" target=\"_self\">Official installation guide</a> for details.</p> <p>Supported OpenvSwitch dataplanes:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>OVS-kernel</p></li> <li class=\"has-marker\"><p>OVS-doca</p></li> </ul> <p>Check <a class=\"reference external\" href=\"https://docs.nvidia.com/doca/sdk/openvswitch+offload+(ovs+in+doca)/index.html\" target=\"_self\">OpenvSwitch Offload</a> document to know about differences.</p> <h4 id=\"ovs_kernel\">OVS-kernel</h4> <p><i>These steps are for OVS-kernel data plane, to use OVS-doca follow instructions from the relevant section.</i></p> <h5 id=\"prepare_worker_nodes\">Prepare Worker Nodes</h5> <p>Configure Open_vSwitch</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">ovs-vsctl set Open_vSwitch . other_config:hw-offload=true</div></pre></div> <p>Restart Open_vSwitch</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">systemctl restart openvswitch-switch.service</div></pre></div> <h5 id=\"sriov_network_operator_configuration\">Sriov Network Operator Configuration</h5> <p>Create SriovNetworkNodePolicy for selected NIC</p> <div class=\"code-body \"><pre><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkNodePolicy<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ovs-switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>eSwitchMode<span class=\"p\">:</span><span class=\"w\"> </span>switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nicSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deviceID<span class=\"p\">:</span><span class=\"w\"> </span>101d<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>15b3<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>node-role.kubernetes.io/worker<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>numVfs<span class=\"p\">:</span><span class=\"w\"> </span>4<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>isRdma<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkType<span class=\"p\">:</span><span class=\"w\"> </span>ETH<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>bridge<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>ovs<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">{}</span><span class=\"w\"></span></div></pre></div> <p>Create OVSNetwork CR</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>OVSNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ovs<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>default<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"nv-ipam\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"poolName\": \"pool1\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>switchdev<span class=\"w\"></span></div></pre></div> <h4 id=\"ovs_doca\">OVS-doca</h4> <p><i>These steps are for OVS-doca data plane, to use OVS-kernel follow instructions from the relevant section.</i></p> <h5 id=\"id1\">Prepare Worker Nodes</h5> <p>Configure hugepages</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">mkdir -p /hugepages</div><div class=\"code-line\">mount -t hugetlbfs hugetlbfs /hugepages</div><div class=\"code-line\">echo 4096 &gt; /sys/devices/system/node/node0/hugepages/hugepages-2048kB/nr_hugepages</div></pre></div> <p><i>Note: for multi CPU system hugepages should be created for each NUMA node: node0, node1, …</i></p> <p>Configure system to create hugepages on boot</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">echo \"vm.nr_hugepages=8192\" &gt; /etc/sysctl.d/99-hugepages.conf</div></pre></div> <p><i>Note: this example is for a server with two CPU</i></p> <p>Configure Open_vSwitch</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">ovs-vsctl --no-wait set Open_vSwitch . other_config:doca-init=true</div><div class=\"code-line\">ovs-vsctl set Open_vSwitch . other_config:hw-offload=true</div></pre></div> <p>Restart Open_vSwitch</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">systemctl restart openvswitch-switch.service</div></pre></div> <h5 id=\"id2\">Sriov Network Operator Configuration</h5> <p>Create SriovNetworkNodePolicy for selected NIC</p> <div class=\"code-body \"><pre><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkNodePolicy<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ovs-switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>eSwitchMode<span class=\"p\">:</span><span class=\"w\"> </span>switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nicSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>deviceID<span class=\"p\">:</span><span class=\"w\"> </span>101d<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>15b3<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>node-role.kubernetes.io/worker<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>numVfs<span class=\"p\">:</span><span class=\"w\"> </span>4<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>isRdma<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkType<span class=\"p\">:</span><span class=\"w\"> </span>ETH<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>bridge<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>ovs<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>bridge<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>datapathType<span class=\"p\">:</span><span class=\"w\"> </span>netdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>uplink<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>interface<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>type<span class=\"p\">:</span><span class=\"w\"> </span>dpdk<span class=\"w\"></span></div></pre></div> <p>Create OVSNetwork CR</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>OVSNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ovs<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>default<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"nv-ipam\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"poolName\": \"pool1\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>switchdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>interfaceType<span class=\"p\">:</span><span class=\"w\"> </span>dpdk<span class=\"w\"></span></div></pre></div> <h4 id=\"test_workload\">Test Workload</h4> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>apps/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Deployment<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ovs-offload<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>labels<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>app<span class=\"p\">:</span><span class=\"w\"> </span>ovs-offload<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>replicas<span class=\"p\">:</span><span class=\"w\"> </span>2<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>selector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>matchLabels<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>app<span class=\"p\">:</span><span class=\"w\"> </span>ovs-offload<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>template<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>labels<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>app<span class=\"p\">:</span><span class=\"w\"> </span>ovs-offload<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>ovs<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ovs-offload-container<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>command<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"/bin/bash\"<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>\"-c\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>args<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>while true; do sleep 1000; done<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>image<span class=\"p\">:</span><span class=\"w\"> </span>mellanox/rping-test<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"IPC_LOCK\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>nvidia.com/switchdev<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>nvidia.com/switchdev<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div></pre></div> <h4 id=\"troubleshooting_ovs\">Troubleshooting OVS</h4> <p>For OVS hardware offload verification and troubleshooting steps, please refer to the following DOCA documentation:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a class=\"reference external\" href=\"https://docs.nvidia.com/doca/sdk/ovs-kernel+hardware+offloads/index.html\" target=\"_self\">OVS-Kernel Hardware Offloads</a></p></li> <li class=\"has-marker\"><p><a class=\"reference external\" href=\"https://docs.nvidia.com/doca/sdk/ovs-doca+hardware+offloads/index.html\" target=\"_self\">OVS-DOCA Hardware Offloads</a></p></li> </ul> </div></body></html>",
                "topicPages": [],
                "date": "08/08/2024"
            },
            {
                "title": "Getting Started with Red Hat OpenShift",
                "topicId": "getting_started_with_red_hat_openshift",
                "figures": [],
                "copyright": "© Copyright 2024, NVIDIA.",
                "table": [],
                "body": "<html><head></head><body><div> <p class=\"topic-title\">On this page</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_on_an_openshift_container_platform\">Network Operator Deployment on an OpenShift Container Platform</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#node_feature_discovery\">Node Feature Discovery</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_operator\">SR-IOV Network Operator</a></p></li> <li class=\"has-marker\"><p><a href=\"#gpu_operator\">GPU Operator</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_installation\">Network Operator Installation</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#network_operator_installation_using_openshift_catalog\">Network Operator Installation Using OpenShift Catalog</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_installation_using_openshift_oc_cli\">Network Operator Installation using OpenShift OC CLI</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#verification\">Verification</a></p></li> </ul> </li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#using_network_operator_to_create_nicclusterpolicy_in_openshift_container_platform\">Using Network Operator to Create NicClusterPolicy in OpenShift Container Platform</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#deployment_examples_for_openshift_container_platform\">Deployment Examples For OpenShift Container Platform</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_a_host_device_network_ocp\">Network Operator Deployment with a Host Device Network - OCP</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_sr_iov_legacy_mode_ocp\">Network Operator Deployment with SR-IOV Legacy Mode - OCP</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_with_the_rdma_shared_device_plugin_ocp\">Network Operator Deployment with the RDMA Shared Device Plugin - OCP</a></p></li> <li class=\"has-marker\"><p><a href=\"#network_operator_deployment_for_dpdk_workloads_ocp\">Network Operator Deployment for DPDK Workloads - OCP</a></p></li> </ul> </li> </ul> </li> </ul> </li> </ul> <br><h2 id=\"network_operator_deployment_on_an_openshift_container_platform\">Network Operator Deployment on an OpenShift Container Platform</h2><div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Currently, NVIDIA Network Operator does not support Single Node OpenShift (SNO) deployments.</p> </div></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>It is recommended to have dedicated control plane nodes for OpenShift deployments with NVIDIA Network Operator.</p> </div></div> <h3 id=\"node_feature_discovery\">Node Feature Discovery</h3> <p>To enable Node Feature Discovery, please follow the official <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/hardware_enablement/psap-node-feature-discovery-operator.html\" target=\"_self\">guide</a>.</p> <p>An example of Node Feature Discovery configuration:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>nfd.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>NodeFeatureDiscovery<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>nfd-instance<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>openshift-nfd<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>operand<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>openshift-nfd<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>image<span class=\"p\">:</span><span class=\"w\"> </span>registry.redhat.io/openshift4/ose-node-feature-discovery:v4.10<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>Always<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>workerConfig<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>configData<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>sources:<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>pci:<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>deviceClassWhitelist:<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>- \"02\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>- \"03\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>- \"0200\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>- \"0207\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">          </span>deviceLabelFields:<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">            </span>- vendor<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>customConfig<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>configData<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div></pre></div> <p>Verify that the following label is present on the nodes containing NVIDIA networking hardware: <cite>feature.node.kubernetes.io/pci-15b3.present=true</cite></p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc describe node <span class=\"p\">|</span> grep -E 'Roles|pci' <span class=\"p\">|</span> grep -v \"control-plane\"</div><div class=\"code-line\"></div><div class=\"code-line\">Roles:              worker</div><div class=\"code-line\">                    cpu-feature.node.kubevirt.io/invpcid=true</div><div class=\"code-line\">                    cpu-feature.node.kubevirt.io/pcid=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-102b.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-10de.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-10de.sriov.capable=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-14e4.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-15b3.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-15b3.sriov.capable=true</div><div class=\"code-line\">Roles:              worker</div><div class=\"code-line\">                    cpu-feature.node.kubevirt.io/invpcid=true</div><div class=\"code-line\">                    cpu-feature.node.kubevirt.io/pcid=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-102b.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-10de.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-10de.sriov.capable=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-14e4.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-15b3.present=true</div><div class=\"code-line\">                    feature.node.kubernetes.io/pci-15b3.sriov.capable=true</div></pre></div> <h3 id=\"sr_iov_network_operator\">SR-IOV Network Operator</h3> <p>If you are planning to use SR-IOV, follow these <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/networking/hardware_networks/installing-sriov-operator.html\" target=\"_self\">instructions</a> to install SR-IOV Network Operator on an OpenShift Container Platform.</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The SR-IOV resources created will have the <cite>openshift.io</cite> prefix.</p> </div></div> <p>For the default SriovOperatorConfig CR to work with the MLNX_OFED container, please run this command to update the following values:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc patch sriovoperatorconfig default \\</div><div class=\"code-line\">  --type=merge -n openshift-sriov-network-operator \\</div><div class=\"code-line\">  --patch '{ \"spec\": { \"configDaemonNodeSelector\": { \"network.nvidia.com/operator.mofed.wait\": \"false\", \"node-role.kubernetes.io/worker\": \"\", \"feature.node.kubernetes.io/pci-15b3.sriov.capable\": \"true\" } } }'</div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>SR-IOV Network Operator configuration documentation can be found on the <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-operator.html#configuring-sriov-operator\" target=\"_self\">Official Website</a>.</p> </div></div> <h3 id=\"gpu_operator\">GPU Operator</h3> <p>If you plan to use GPUDirect, follow <a class=\"reference external\" href=\"https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/openshift/contents.html\" target=\"_self\">this</a> to install GPU Operator on an OpenShift Container Platform.</p> <p>Make sure to enable RDMA and disable useHostMofed in the driver section in the spec of the ClusterPolicy CR.</p> <h3 id=\"network_operator_installation\">Network Operator Installation</h3> <h4 id=\"network_operator_installation_using_openshift_catalog\">Network Operator Installation Using OpenShift Catalog</h4> <ul class=\"simple\"> <li class=\"has-marker\"><p>In the OpenShift Container Platform web console side menu, select Operators &gt; OperatorHub, and search for the NVIDIA Network Operator.</p></li> <li class=\"has-marker\"><p>Select NVIDIA Network Operator, and click Install in the first screen and in the subsequent one.</p></li> <li class=\"has-marker\"><p>For additional information, see the <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/operators/admin/olm-adding-operators-to-cluster.html\" target=\"_self\">Red Hat OpenShift Container Platform Documentation</a>.</p></li> </ul> <h4 id=\"network_operator_installation_using_openshift_oc_cli\">Network Operator Installation using OpenShift OC CLI</h4> <ol class=\"arabic\"> <li><p>Create a namespace for the Network Operator.</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc create namespace nvidia-network-operator</div></pre></div> </li> <li><p>Install the Network Operator in the namespace created in the previous step by creating the below objects. Run the following command to get the channel value required for the next step:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc get packagemanifest nvidia-network-operator -n openshift-marketplace -o jsonpath='{.status.defaultChannel}'</div></pre></div> <p>Example output:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">stable</div></pre></div> </li> <li><p>Create the following Subscription CR, and save the YAML in the network-operator-sub.yaml file:</p> apiVersion: operators.coreos.com/v1alpha1 kind: Subscription metadata: name: nvidia-network-operator namespace: nvidia-network-operator spec: channel: \"v24.4.0\" installPlanApproval: Manual name: nvidia-network-operator source: certified-operators sourceNamespace: openshift-marketplace </li> <li><p>Create the subscription object by running the following command:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc create -f network-operator-sub.yaml</div></pre></div> </li> <li><p>Change to the network-operator project:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc project nvidia-network-operator</div></pre></div> </li> </ol> <h5 id=\"verification\">Verification</h5> <p>To verify that the operator deployment is successful, run:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc get pods -n nvidia-network-operator</div></pre></div> <p>Example output:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">NAME                                                          READY   STATUS    RESTARTS   AGE</div><div class=\"code-line\">nvidia-network-operator-controller-manager-8f8ccf45c-zgfsq    2/2     Running   0          1m</div></pre></div> <p>A successful deployment shows a <cite>Running</cite> status.</p> <h3 id=\"using_network_operator_to_create_nicclusterpolicy_in_openshift_container_platform\">Using Network Operator to Create NicClusterPolicy in OpenShift Container Platform</h3> <p>See Deployment Examples for OCP:</p> <h4 id=\"deployment_examples_for_openshift_container_platform\">Deployment Examples For OpenShift Container Platform</h4> <p>In OCP, some components are deployed by default like Multus and WhereAbouts, whereas others, such as NFD and SR-IOV Network Operator must be deployed manually, as described in the Installation section.</p> <p>In addition, since there is no use of the Helm chart, the configuration should be done via the NicClusterPolicy CRD.</p> <p>Following are examples of NicClusterPolicy configuration for OCP.</p> <h5 id=\"network_operator_deployment_with_a_host_device_network_ocp\">Network Operator Deployment with a Host Device Network - OCP</h5> <p>Network Operator deployment with:</p> <p>SR-IOV device plugin, single SR-IOV resource pool:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>There is no need for a secondary network configuration, as it is installed by default in OCP.</p></li> </ul> apiVersion: mellanox.com/v1alpha1 kind: NicClusterPolicy metadata: name: nic-cluster-policy spec: ofedDriver: image: doca-driver repository: nvcr.io/nvidia/mellanox version: 24.04-0.6.6.0-0 startupProbe: initialDelaySeconds: 10 periodSeconds: 20 livenessProbe: initialDelaySeconds: 30 periodSeconds: 30 readinessProbe: initialDelaySeconds: 10 periodSeconds: 30 sriovDevicePlugin: image: sriov-network-device-plugin repository: ghcr.io/k8snetworkplumbingwg version: e6ead1e8f76a407783430ee2666b403db2d76f64 config: | { \"resourceList\": [ { \"resourcePrefix\": \"nvidia.com\", \"resourceName\": \"hostdev\", \"selectors\": { \"vendors\": [\"15b3\"], \"isRdma\": true } } ] } <p>Following the deployment, the Network Operator should be configured, and K8s networking deployed to use it in pod configuration. The <cite>host-device-net.yaml`</cite> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>HostDeviceNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>\"default\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>\"nvidia.com/hostdev\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">|</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>{<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"type\": \"whereabouts\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"datastore\": \"kubernetes\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"kubernetes\": {<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>\"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>},<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"range\": \"192.168.3.225/28\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"exclude\": [<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.229/30\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">       </span>\"192.168.3.236/32\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>],<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_file\" : \"/var/log/whereabouts.log\",<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>\"log_level\" : \"info\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>}<span class=\"w\"></span></div></pre></div> <p>The <cite>pod.yaml</cite> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-test-pod<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>hostdev-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>restartPolicy<span class=\"p\">:</span><span class=\"w\"> </span>OnFailure<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>image<span class=\"p\">:</span><span class=\"w\"> </span>&lt;rdma image&gt;<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>name<span class=\"p\">:</span><span class=\"w\"> </span>mofed-test-ctr<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span><span class=\"w\"> </span>\"IPC_LOCK\"<span class=\"w\"> </span><span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/hostdev<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>nvidia.com/hostdev<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div></pre></div> <h5 id=\"network_operator_deployment_with_sr_iov_legacy_mode_ocp\">Network Operator Deployment with SR-IOV Legacy Mode - OCP</h5> <p>This deployment mode supports SR-IOV in legacy mode. Note that the SR-IOV Network Operator is required as described in the Deployment for OCP section.</p> apiVersion: mellanox.com/v1alpha1 kind: NicClusterPolicy metadata: name: nic-cluster-policy spec: ofedDriver: image: doca-driver repository: nvcr.io/nvidia/mellanox version: 24.04-0.6.6.0-0 startupProbe: initialDelaySeconds: 10 periodSeconds: 20 livenessProbe: initialDelaySeconds: 30 periodSeconds: 30 readinessProbe: initialDelaySeconds: 10 periodSeconds: 30 <p>Sriovnetwork node policy and K8s networking should be deployed. <cite>sriovnetwork-node-policy.yaml</cite> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>sriovnetwork.openshift.io/v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>SriovNetworkNodePolicy<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>policy-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\">  </span>openshift-sriov-network-operator<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceType<span class=\"p\">:</span><span class=\"w\"> </span>netdevice<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nicSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>vendor<span class=\"p\">:</span><span class=\"w\"> </span>\"15b3\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>pfNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"ens2f0\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>nodeSelector<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>feature.node.kubernetes.io/pci-15b3.present<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>numVfs<span class=\"p\">:</span><span class=\"w\"> </span>8<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>priority<span class=\"p\">:</span><span class=\"w\"> </span>90<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>isRdma<span class=\"p\">:</span><span class=\"w\"> </span>true<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>resourceName<span class=\"p\">:</span><span class=\"w\"> </span>sriovlegacy<span class=\"w\"></span></div></pre></div> <p>The <cite>sriovnetwork.yaml</cite> configuration file for such a deployment:</p> apiVersion: sriovnetwork.openshift.io/v1 kind: SriovNetwork metadata: name: \"sriov-network\" namespace:  openshift-sriov-network-operator spec: vlan: 0 networkNamespace: \"default\" resourceName: \"sriovlegacy\" ipam: |- { \"datastore\": \"kubernetes\", \"kubernetes\": { \"kubeconfig\": \"/etc/cni/net.d/whereabouts.d/whereabouts.kubeconfig\" }, \"log_file\": \"/tmp/whereabouts.log\", \"log_level\": \"debug\", \"type\": \"whereabouts\", \"range\": \"192.168.101.0/24\" } <p>Note that the resource prefix in this case will be <cite>openshift.io</cite>. The <cite>pod.yaml</cite> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>testpod1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>sriov-network<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>appcntr1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>image<span class=\"p\">:</span><span class=\"w\"> </span>&lt;image&gt;<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>imagePullPolicy<span class=\"p\">:</span><span class=\"w\"> </span>IfNotPresent<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>\"IPC_LOCK\"<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>command<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sh<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>-c<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>sleep inf<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>openshift.io/sriovlegacy<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>openshift.io/sriovlegacy<span class=\"p\">:</span><span class=\"w\"> </span>'1'<span class=\"w\"></span></div></pre></div> <h5 id=\"network_operator_deployment_with_the_rdma_shared_device_plugin_ocp\">Network Operator Deployment with the RDMA Shared Device Plugin - OCP</h5> <p>The following is an example of RDMA Shared with MacVlanNetwork:</p> apiVersion: mellanox.com/v1alpha1 kind: NicClusterPolicy metadata: name: nic-cluster-policy spec: ofedDriver: image: doca-driver repository: nvcr.io/nvidia/mellanox version: 24.04-0.6.6.0-0 startupProbe: initialDelaySeconds: 10 periodSeconds: 20 livenessProbe: initialDelaySeconds: 30 periodSeconds: 30 readinessProbe: initialDelaySeconds: 10 periodSeconds: 30 rdmaSharedDevicePlugin: config: | { \"configList\": [ { \"resourceName\": \"rdmashared\", \"rdmaHcaMax\": 1000, \"selectors\": { \"ifNames\": [\"enp4s0f0np0\"] } } ] } image: k8s-rdma-shared-dev-plugin repository: nvcr.io/nvidia/cloud-native version: 1.4.0 <p>The <cite>macvlan-net-ocp.yaml</cite> configuration file for such a deployment in an OpenShift Platform:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>mellanox.com/v1alpha1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>MacvlanNetwork<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdmashared-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>networkNamespace<span class=\"p\">:</span><span class=\"w\"> </span>default<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>master<span class=\"p\">:</span><span class=\"w\"> </span>enp4s0f0np0<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mode<span class=\"p\">:</span><span class=\"w\"> </span>bridge<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>mtu<span class=\"p\">:</span><span class=\"w\"> </span>1500<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ipam<span class=\"p\">:</span><span class=\"w\"> </span>'{\"type\":\"whereabouts\",\"range\":\"16.0.2.0/24\",\"gateway\":\"16.0.2.1\"}'<span class=\"w\"></span></div></pre></div> <p>The <cite>pod.yaml</cite> configuration file for such a deployment:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Pod<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>test-rdma-shared-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>annotations<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>k8s.v1.cni.cncf.io/networks<span class=\"p\">:</span><span class=\"w\"> </span>rdmashared-net<span class=\"w\"></span></div><div class=\"code-line\">spec<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>containers<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>image<span class=\"p\">:</span><span class=\"w\"> </span>myimage<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma-shared-1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>securityContext<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>capabilities<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>add<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>IPC_LOCK<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>rdma/rdmashared<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">      </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">        </span>rdma/rdmashared<span class=\"p\">:</span><span class=\"w\"> </span>1<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>restartPolicy<span class=\"p\">:</span><span class=\"w\"> </span>OnFailure<span class=\"w\"></span></div></pre></div> <h5 id=\"network_operator_deployment_for_dpdk_workloads_ocp\">Network Operator Deployment for DPDK Workloads - OCP</h5> <p>In order to configure <cite>HUGEPAGES</cite> in OpenShift, refer to this <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/scalability_and_performance/what-huge-pages-do-and-how-they-are-consumed-by-apps.html\" target=\"_self\">steps</a>.</p> <p>For SR-IOV Network Operator configuration instructions, visit the Official <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-operator.html#configuring-sriov-operator\" target=\"_self\">Website</a>.</p> </div></body></html>",
                "topicPages": [],
                "date": "08/08/2024"
            },
            {
                "title": "Customization Options",
                "topicId": "customization_options",
                "figures": [],
                "copyright": "© Copyright 2024, NVIDIA.",
                "table": [],
                "body": "<html><head></head><body><div> <ul> <li class=\"toctree-l1 has-marker\"><a href=\"https://docs.nvidia.com/helm.html\">Helm Chart</a><br><ul> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#general-parameters\">General Parameters</a><br><ul> <li class=\"toctree-l3 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#imagepullsecrets-customization\">ImagePullSecrets customization</a></li> </ul> </li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#nfd-labels\">NFD labels</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#sr-iov-network-operator\">SR-IOV Network Operator</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#container-resources\">Container Resources</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#mlnx-ofed-driver\">MLNX_OFED Driver</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#mlnx-ofed-driver-environment-variables\">MLNX_OFED Driver Environment Variables</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#rdma-shared-device-plugin\">RDMA Shared Device Plugin</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#rdma-device-plugin-resource-configurations\">RDMA Device Plugin Resource Configurations</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#sr-iov-network-device-plugin\">SR-IOV Network Device Plugin</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#sr-iov-network-device-plugin-resource-configuration\">SR-IOV Network Device Plugin Resource Configuration</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#ib-kubernetes\">IB Kubernetes</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#ufm-secret\">UFM Secret</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#secondary-network\">Secondary Network</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#cni-plugin\">CNI Plugin</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#id7\">Multus CNI</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#id9\">IPoIB CNI</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#ipam-cni-plugin\">IPAM CNI Plugin</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#nvidia-ipam-plugin\">NVIDIA IPAM Plugin</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#nvidia-nic-feature-discovery\">NVIDIA NIC Feature Discovery</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#doca-telemetry-service\">DOCA Telemetry Service</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/helm.html#helm-customization-file\">Helm customization file</a></li> </ul> </li> <li class=\"toctree-l1 has-marker\"><a href=\"https://docs.nvidia.com/crds.html\">CRDs</a><br><ul> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/crds.html#nicclusterpolicy-crd\">NicClusterPolicy CRD</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/crds.html#macvlannetwork-crd\">MacVlanNetwork CRD</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/crds.html#hostdevicenetwork-crd\">HostDeviceNetwork CRD</a></li> <li class=\"toctree-l2 has-marker\"><a href=\"https://docs.nvidia.com/crds.html#ipoibnetwork-crd\">IPoIBNetwork CRD</a></li> </ul> </li> </ul> <br></div></body></html>",
                "topicPages": [{
                        "title": "Helm Chart Customization Options",
                        "topicId": "helm_chart_customization_options",
                        "figures": [],
                        "copyright": "© Copyright 2024, NVIDIA.",
                        "table": [],
                        "body": "<html><head></head><body><div><p>There are various customizations you can do to tailor the deployment of the Network Operator to your cluster needs. You can find those below.</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#general_parameters\">General Parameters</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#imagepullsecrets_customization\">ImagePullSecrets customization</a></p></li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#nfd_labels\">NFD labels</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_operator\">SR-IOV Network Operator</a></p></li> <li class=\"has-marker\"><p><a href=\"#container_resources\">Container Resources</a></p></li> <li class=\"has-marker\"><p><a href=\"#mlnx_ofed_driver\">MLNX_OFED Driver</a></p></li> <li class=\"has-marker\"><p><a href=\"#mlnx_ofed_driver_environment_variables\">MLNX_OFED Driver Environment Variables</a></p></li> <li class=\"has-marker\"><p><a href=\"#rdma_shared_device_plugin\">RDMA Shared Device Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#rdma_device_plugin_resource_configurations\">RDMA Device Plugin Resource Configurations</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_device_plugin\">SR-IOV Network Device Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_device_plugin_resource_configuration\">SR-IOV Network Device Plugin Resource Configuration</a></p></li> <li class=\"has-marker\"><p><a href=\"#ib_kubernetes\">IB Kubernetes</a></p></li> <li class=\"has-marker\"><p><a href=\"#ufm_secret\">UFM Secret</a></p></li> <li class=\"has-marker\"><p><a href=\"#secondary_network\">Secondary Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#cni_plugin\">CNI Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#id7\">Multus CNI</a></p></li> <li class=\"has-marker\"><p><a href=\"#id9\">IPoIB CNI</a></p></li> <li class=\"has-marker\"><p><a href=\"#ipam_cni_plugin\">IPAM CNI Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#nvidia_ipam_plugin\">NVIDIA IPAM Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#nvidia_nic_feature_discovery\">NVIDIA NIC Feature Discovery</a></p></li> <li class=\"has-marker\"><p><a href=\"#doca_telemetry_service\">DOCA Telemetry Service</a></p></li> <li class=\"has-marker\"><p><a href=\"#helm_customization_file\">Helm customization file</a></p></li> </ul> <br><h2 id=\"general_parameters\">General Parameters</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>operator.admissionController.enabled</td> <td>Bool</td> <td>False</td> <td>Deploy with admission controller</td> </tr> <tr class=\"row-odd\"><td>operator.admissionController.useCertManager</td> <td>Bool</td> <td>True</td> <td>Use cert-manager for generating self-signed certificate</td> </tr> <tr class=\"row-even\"><td>operator.admissionController.certificate.tlsCrt</td> <td>String</td> <td>“”</td> <td>External TLS certificate. Ignored if cert-manager is used</td> </tr> <tr class=\"row-odd\"><td>operator.admissionController.certificate.tlsKey</td> <td>String</td> <td>“”</td> <td>External TLS private key. Ignored if cert-manager is used</td> </tr> <tr class=\"row-even\"><td>nfd.enabled</td> <td>Bool</td> <td>True</td> <td>Deploy Node Feature Discovery</td> </tr> <tr class=\"row-odd\"><td>nfd.deployNodeFeatureRules</td> <td>Bool</td> <td>True</td> <td>Deploy Node Feature Rules to label the nodes</td> </tr> <tr class=\"row-even\"><td>sriovNetworkOperator.enabled</td> <td>Bool</td> <td>False</td> <td>Deploy SR-IOV Network Operator</td> </tr> <tr class=\"row-odd\"><td>sriovNetworkOperator.configDaemonNodeSelectorExtra</td> <td>List</td> <td>node-role.kubernetes.io/worker: “”</td> <td>Additional values for SR-IOV Config Daemon nodes selector</td> </tr> <tr class=\"row-even\"><td>upgradeCRDs</td> <td>Bool</td> <td>True</td> <td>Enable CRDs upgrade with helm pre-install and pre-upgrade hooks</td> </tr> <tr class=\"row-odd\"><td>operator.repository</td> <td>String</td> <td>nvcr.io/nvidia</td> <td>Network Operator image repository</td> </tr> <tr class=\"row-even\"><td>operator.image</td> <td>String</td> <td>network-operator</td> <td>Network Operator image name</td> </tr> <tr class=\"row-odd\"><td>operator.tag</td> <td>String</td> <td>None</td> <td>Network Operator image tag. If set to <bsp-code-inline code=\"None\">None</bsp-code-inline>, the chart’s <bsp-code-inline code=\"appVersion\">appVersion</bsp-code-inline> will be used</td> </tr> <tr class=\"row-even\"><td>operator.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling Network Operator image</td> </tr> <tr class=\"row-odd\"><td>operator.cniBinDirectory</td> <td>String</td> <td>/opt/cni/bin</td> <td>Directory, where CNI binaries will be deployed on the nodes. Setting for the sriov-network-operator is set with <bsp-code-inline code=\"sriov-network-operator.cniBinPath\">sriov-network-operator.cniBinPath</bsp-code-inline> parameter. Note that the CNI bin directory should be aligned with the CNI bin directory in the container runtime.</td> </tr> <tr class=\"row-even\"><td>operator.resources</td> <td>Yaml</td> <td> resources:<br> limits:<br> cpu: 500m<br> memory: 128Mi<br> <br> requests:<br> cpu: 5m<br> memory: 64Mi<br> <br> <br> <br> </td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the operator</td> </tr> <tr class=\"row-odd\"><td>imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the Network Operator image, if it is not overridden</td> </tr> <tr class=\"row-even\"><td>deployCR</td> <td>Bool</td> <td>False</td> <td>Deploy <bsp-code-inline code=\"NicClusterPolicy\">NicClusterPolicy</bsp-code-inline> custom resource according to the provided parameters</td> </tr> <tr class=\"row-odd\"><td>nodeAffinity</td> <td>Yaml</td> <td> requiredDuringSchedulingIgnoredDuringExecution:<br> nodeSelectorTerms:<br> - matchExpressions:<br> - key: node-role.kubernetes.io/master<br> operator: DoesNotExist<br> <br> - key: node-role.kubernetes.io/control-plane<br> operator: DoesNotExist<br> <br> <br> <br> <br> <br> </td> <td>Configure node affinity settings for Network Operator components</td> </tr> <tr class=\"row-even\"><td>tolerations</td> <td>Yaml</td> <td>“”</td> <td>Set additional tolerations for various Daemonsets deployed by the network operator, e.g. whereabouts, multus, cni-plugins.</td> </tr> <tr class=\"row-odd\"><td>useDTK</td> <td>Bool</td> <td>True</td> <td>Enable the use of Driver ToolKit to compile OFED drivers (OpenShift only)</td> </tr> </tbody> </table> <h3 id=\"imagepullsecrets_customization\">ImagePullSecrets customization</h3> <p>To provide <cite>imagePullSecrets`</cite> object references, you need to specify them using a following structure:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">imagePullSecrets:</div><div class=\"code-line\">  - image-pull-secret1</div><div class=\"code-line\">  - image-pull-secret2</div></pre></div> <h2 id=\"nfd_labels\">NFD labels</h2><p>The NFD labels required by the Network Operator and GPU Operator:</p> <table> <colgroup> <col style=\"width: 50%\"> <col style=\"width: 50%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Label</p></th> <th class=\"head\"><p>Location</p></th> </tr> <tr class=\"row-even\"><td>feature.node.kubernetes.io/pci-15b3.present</td> <td>Nodes containing NVIDIA Networking hardware</td> </tr> <tr class=\"row-odd\"><td>feature.node.kubernetes.io/pci-10de.present</td> <td>Nodes containing NVIDIA GPU hardware</td> </tr> </tbody> </table> <h2 id=\"sr_iov_network_operator\">SR-IOV Network Operator</h2><p>SR-IOV Network Operator Helm chart customization options can be found <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/sriov-network-operator/blob/master/deployment/sriov-network-operator/README.md\" target=\"_self\">here</a>. Following is a list of overriden values by NVIDIA Operator Helm Chart:</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default in NVIDIA Network Operator</p></th> <th class=\"head\"><p>Notes</p></th> </tr> <tr class=\"row-even\"><td>sriov-network-operator.operator.resourcePrefix</td> <td>String</td> <td>nvidia.com</td> <td></td> </tr> <tr class=\"row-odd\"><td>sriov-network-operator.images.operator</td> <td>String</td> <td>nvcr.io/nvidia/mellanox/sriov-network-operator:network-operator-24.4.0</td> <td></td> </tr> <tr class=\"row-even\"><td>sriov-network-operator.images.sriovConfigDaemon</td> <td>String</td> <td>nvcr.io/nvidia/mellanox/sriov-network-operator-config-daemon:network-operator-24.4.0</td> <td></td> </tr> <tr class=\"row-odd\"><td>sriov-network-operator.images.sriovCni</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg/sriov-cni:3e6368077716f6b8368b0e036a1290d1c64cf1fb</td> <td>For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/sriov-cni:v2.8.0-arm64\">ghcr.io/k8snetworkplumbingwg/sriov-cni:v2.8.0-arm64</bsp-code-inline> image</td> </tr> <tr class=\"row-even\"><td>sriov-network-operator.images.ibSriovCni</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:fc002af57a81855542759d0f77d16dacd7e1aa38</td> <td>For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:1.1.0-arm64\">ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:1.1.0-arm64</bsp-code-inline> image</td> </tr> <tr class=\"row-odd\"><td>sriov-network-operator.images.sriovDevicePlugin</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:e6ead1e8f76a407783430ee2666b403db2d76f64</td> <td>For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-arm64\">ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-arm64</bsp-code-inline> image</td> </tr> <tr class=\"row-even\"><td>sriov-network-operator.images.webhook</td> <td>String</td> <td>nvcr.io/nvidia/mellanox/sriov-network-operator-webhook:network-operator-24.4.0</td> <td></td> </tr> </tbody> </table> <h2 id=\"container_resources\">Container Resources</h2><p>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">requests and limits</a> can be configured for each container of the sub-resources deployed by the Network Operator by setting the parameter <bsp-code-inline code=\"containerResources\">containerResources</bsp-code-inline>.</p> <p>For example:</p> <div class=\"code-body \"><pre><div class=\"code-line\">containerResources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>\"mofed-container\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>cpu<span class=\"p\">:</span><span class=\"w\"> </span>\"200m\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>memory<span class=\"p\">:</span><span class=\"w\"> </span>\"150Mi\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>cpu<span class=\"p\">:</span><span class=\"w\"> </span>\"300m\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>memory<span class=\"p\">:</span><span class=\"w\"> </span>\"300Mi\"<span class=\"w\"></span></div></pre></div> <h2 id=\"mlnx_ofed_driver\">MLNX_OFED Driver</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>ofedDriver.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy the MLNX_OFED driver container</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.repository</td> <td>String</td> <td>nvcr.io/nvidia/mellanox</td> <td>MLNX_OFED driver image repository</td> </tr> <tr class=\"row-even\"><td>ofedDriver.image</td> <td>String</td> <td>doca-driver</td> <td>MLNX_OFED driver image name</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.version</td> <td>String</td> <td>24.04-0.6.6.0-0</td> <td>MLNX_OFED driver version</td> </tr> <tr class=\"row-even\"><td>ofedDriver.initContainer.enable</td> <td>Bool</td> <td>true</td> <td>Deploy init container</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.initContainer.repository</td> <td>string</td> <td>ghcr.io/mellanox</td> <td>init container image repository</td> </tr> <tr class=\"row-even\"><td>ofedDriver.initContainer.image</td> <td>string</td> <td>network-operator-init-container</td> <td>init container image name</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.initContainer.version</td> <td>string</td> <td>v0.0.2</td> <td>init container image version</td> </tr> <tr class=\"row-even\"><td>ofedDriver.certConfig.name</td> <td>String</td> <td>“”</td> <td>Custom TLS key/certificate configuration configMap name</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.repoConfig.name</td> <td>String</td> <td>“”</td> <td>Private mirror repository configuration configMap name</td> </tr> <tr class=\"row-even\"><td>ofedDriver.terminationGracePeriodSeconds</td> <td>Int</td> <td>300</td> <td>NVIDIA OFED termination grace periods in seconds</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the MLNX_OFED driver images</td> </tr> <tr class=\"row-even\"><td>ofedDriver.env</td> <td>List</td> <td>[]</td> <td>An optional list of <a class=\"reference external\" href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.29/#envvar-v1-core\" target=\"_self\">environment variables</a> passed to the NVIDIA OFED driver image</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.startupProbe.initialDelaySeconds</td> <td>Int</td> <td>10</td> <td>MLNX_OFED startup probe initial delay</td> </tr> <tr class=\"row-even\"><td>ofedDriver.startupProbe.periodSeconds</td> <td>Int</td> <td>20</td> <td>MLNX_OFED startup probe interval</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.livenessProbe.initialDelaySeconds</td> <td>Int</td> <td>30</td> <td>MLNX_OFED liveness probe initial delay</td> </tr> <tr class=\"row-even\"><td>ofedDriver.livenessProbe.periodSeconds</td> <td>Int</td> <td>30</td> <td>MLNX_OFED liveness probe interval</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.readinessProbe.initialDelaySeconds</td> <td>Int</td> <td>10</td> <td>MLNX_OFED readiness probe initial delay</td> </tr> <tr class=\"row-even\"><td>ofedDriver.readinessProbe.periodSeconds</td> <td>Int</td> <td>30</td> <td>MLNX_OFED readiness probe interval</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.autoUpgrade</td> <td>Bool</td> <td>true</td> <td>A global switch for the automatic upgrade feature. If set to false, all other options are ignored.</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.maxParallelUpgrades</td> <td>Int</td> <td>1</td> <td>The amount of nodes that can be upgraded in parallel. 0 means no limit. All nodes will be upgraded in parallel.</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.safeLoad</td> <td>Bool</td> <td>false</td> <td>Cordon and drain (if enabled) a node before loading the driver on it, requires <bsp-code-inline code=\"ofedDriver.initContainer\">ofedDriver.initContainer</bsp-code-inline> to be enabled and <bsp-code-inline code=\"ofedDriver.upgradePolicy.autoUpgrade\">ofedDriver.upgradePolicy.autoUpgrade</bsp-code-inline> to be true</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.drain.enable</td> <td>Bool</td> <td>true</td> <td>Options for node drain (<bsp-code-inline code=\"kubectl drain\">kubectl drain</bsp-code-inline>) before driver reload, if auto upgrade is enabled.</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.drain.force</td> <td>Bool</td> <td>true</td> <td>Use force drain of pods</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.drain.podSelector</td> <td>String</td> <td>“”</td> <td>Pod selector to specify which pods will be drained from the node. An empty selector means all pods.</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.drain.timeoutSeconds</td> <td>Int</td> <td>300</td> <td>Number of seconds to wait for pod eviction</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.drain.deleteEmptyDir</td> <td>Bool</td> <td>false</td> <td>Delete pods local storage</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.waitForCompletion.podSelector</td> <td>String</td> <td>Not set</td> <td>Specifies a label selector for the pods to wait for completion before starting the driver upgrade</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.waitForCompletion.timeoutSeconds</td> <td>int</td> <td>Not set</td> <td>Specify the length of time in seconds to wait before giving up for workload to finish. Zero means infinite</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> and limits for the <bsp-code-inline code=\"mofed-container\">mofed-container</bsp-code-inline></td> </tr> <tr class=\"row-even\"><td>ofedDriver.forcePrecompiled</td> <td>Bool</td> <td>false</td> <td>Fail Mellanox OFED deployment if precompiled OFED driver container image does not exists</td> </tr> </tbody> </table> <h2 id=\"mlnx_ofed_driver_environment_variables\">MLNX_OFED Driver Environment Variables</h2><p>The following are special environment variables supported by the MLNX_OFED container to configure its behavior:</p> <table> <colgroup> <col style=\"width: 33%\"> <col style=\"width: 33%\"> <col style=\"width: 33%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>CREATE_IFNAMES_UDEV</td> <td> * “true” for Ubuntu 20.04, RHEL v8.x and OCP &lt;= v4.13.<br> * “false” for newer OS.<br> <br> </td> <td>Create an udev rule to preserve “old-style” path based netdev names e.g enp3s0f0</td> </tr> <tr class=\"row-odd\"><td>UNLOAD_STORAGE_MODULES</td> <td>“false”</td> <td> Unload host storage modules prior to loading MLNX_OFED modules:<br> * ib_isert<br> * nvme_rdma<br> * nvmet_rdma<br> * rpcrdma<br> * xprtrdma<br> * ib_srpt<br> <br> <br> </td> </tr> <tr class=\"row-even\"><td>ENABLE_NFSRDMA</td> <td>“false”</td> <td>Enable loading of NFS related storage modules from a MLNX_OFED container</td> </tr> <tr class=\"row-odd\"><td>RESTORE_DRIVER_ON_POD_TERMINATION</td> <td>“true”</td> <td>Restore host drivers when a container</td> </tr> </tbody> </table> <p>In addition, it is possible to specify any environment variables to be exposed to the MLNX_OFED container, such as the standard “HTTP_PROXY”, “HTTPS_PROXY”, “NO_PROXY”.</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>CREATE_IFNAMES_UDEV is set automatically by the Network Operator, depending on the Operating System of the worker nodes in the cluster (the cluster is assumed to be homogenous).</p> </div></div> <p>To set these variables, change them into Helm values. For example:</p> <div class=\"code-body \"><pre><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>env<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>RESTORE_DRIVER_ON_POD_TERMINATION<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>value<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>UNLOAD_STORAGE_MODULES<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>value<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>CREATE_IFNAMES_UDEV<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>value<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div></pre></div> <p>The variables can also be configured directly via the NicClusterPolicy CRD.</p> <h2 id=\"rdma_shared_device_plugin\">RDMA Shared Device Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy RDMA shared device plugin</td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.repository</td> <td>String</td> <td>nvcr.io/nvidia/cloud-native</td> <td>RDMA shared device plugin image repository</td> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.image</td> <td>String</td> <td>k8s-rdma-shared-dev-plugin</td> <td>RDMA shared device plugin image name</td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.version</td> <td>String</td> <td>1.4.0</td> <td>RDMA shared device plugin version</td> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the RDMA Shared device plugin image</td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.resources</td> <td>List</td> <td>See below</td> <td>RDMA shared device plugin resources</td> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.useCdi</td> <td>Bool</td> <td>false</td> <td> Enable Container Device Interface (CDI) mode.<br> <b>NOTE</b>: NVIDIA Network Operator does not configure container runtime to enable CDI<br> <br> </td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"rdma-shared-dp\">rdma-shared-dp</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"rdma_device_plugin_resource_configurations\">RDMA Device Plugin Resource Configurations</h2><p>These configurations consist of a list of RDMA resources, each with a name and a selector of RDMA capable network devices to be associated with the resource. Refer to <a class=\"reference external\" href=\"https://github.com/Mellanox/k8s-rdma-shared-dev-plugin#devices-selectors\" target=\"_self\">RDMA Shared Device Plugin Selectors</a> for supported selectors.</p> <div class=\"code-body \"><pre><div class=\"code-line\">resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceIDs<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>1017<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>enp5s0f0<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>rdmaHcaMax<span class=\"p\">:</span><span class=\"w\"> </span>63<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_b<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceIDs<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>1017<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ib0<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>ib1<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>rdmaHcaMax<span class=\"p\">:</span><span class=\"w\"> </span>63<span class=\"w\"></span></div></pre></div> <h2 id=\"sr_iov_network_device_plugin\">SR-IOV Network Device Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy SR-IOV Network device plugin</td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>SR-IOV Network device plugin image repository</td> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.image</td> <td>String</td> <td>sriov-network-device-plugin</td> <td>SR-IOV Network device plugin image name</td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.version</td> <td>String</td> <td>e6ead1e8f76a407783430ee2666b403db2d76f64</td> <td> SR-IOV Network device plugin version<br> For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-amd64\">ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-amd64</bsp-code-inline> image<br> <br> </td> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the SR-IOV Network device plugin image</td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.resources</td> <td>List</td> <td>See below</td> <td>SR-IOV Network device plugin resources</td> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.useCdi</td> <td>Bool</td> <td>false</td> <td> Enable Container Device Interface (CDI) mode.<br> <b>NOTE</b>: NVIDIA Network Operator does not configure container runtime to enable CD.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"kube-sriovdp\">kube-sriovdp</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"sr_iov_network_device_plugin_resource_configuration\">SR-IOV Network Device Plugin Resource Configuration</h2><p>Consists of a list of RDMA resources, each with a name and a selector of RDMA capable network devices to be associated with the resource. Refer to <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin#device-selectors\" target=\"_self\">SR-IOV Network Device Plugin Selectors</a> for supported selectors.</p> <div class=\"code-body \"><pre><div class=\"code-line\">resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ethernet_rdma<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkTypes<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ether<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>sriov_rdma<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>devices<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>1018<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>drivers<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>mlx5_ib<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div></pre></div> <h2 id=\"ib_kubernetes\">IB Kubernetes</h2><p>ib-kubernetes provides a daemon that works in conjunction with the <a class=\"reference external\" href=\"https://github.com/openshift/sriov-network-operator\" target=\"_self\">SR-IOV Network Device Plugin</a>. It acts on Kubernetes pod object changes (Create/Update/Delete), reading the pod’s network annotation, fetching its corresponding network CRD and reading the PKey. This is done in order to add the newly generated GUID or the predefined GUID in the GUID field of the CRD cni-args to that PKey for pods with <bsp-code-inline code=\"mellanox.infiniband.app\">mellanox.infiniband.app</bsp-code-inline> annotation.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>ibKubernetes.deploy</td> <td>bool</td> <td>false</td> <td>Deploy IB Kubernetes</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.repository</td> <td>string</td> <td>ghcr.io/mellanox</td> <td>IB Kubernetes image repository</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.image</td> <td>string</td> <td>ib-kubernetes</td> <td>IB Kubernetes image name</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.version</td> <td>string</td> <td>v1.0.2</td> <td>IB Kubernetes version</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.imagePullSecrets</td> <td>list</td> <td>[]</td> <td>An optional list of references to secrets used for pulling any of the IB Kubernetes images</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.periodicUpdateSeconds</td> <td>int</td> <td>5</td> <td>Interval of periodic update in seconds</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.pKeyGUIDPoolRangeStart</td> <td>string</td> <td>02:00:00:00:00:00:00:00</td> <td>Minimal available GUID value to be allocated for the pod</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.pKeyGUIDPoolRangeEnd</td> <td>string</td> <td>02:FF:FF:FF:FF:FF:FF:FF</td> <td>Maximal available GUID value to be allocated for the pod</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.ufmSecret</td> <td>string</td> <td>See below</td> <td>Name of the Secret with the NVIDIA UFM access credentials, deployed in advance</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"ib-kubernetes\">ib-kubernetes</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"ufm_secret\">UFM Secret</h2><p>IB Kubernetes must access <a class=\"reference external\" href=\"https://www.nvidia.com/en-us/networking/infiniband/ufm/\" target=\"_self\">NVIDIA UFM</a> in order to manage pods’ GUIDs. To provide its credentials, the secret of the following format should be deployed in advance:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Secret<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ib-kubernetes-ufm-secret<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">stringData<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_USERNAME<span class=\"p\">:</span><span class=\"w\"> </span>\"admin\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_PASSWORD<span class=\"p\">:</span><span class=\"w\"> </span>\"123456\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_ADDRESS<span class=\"p\">:</span><span class=\"w\"> </span>\"ufm-hostname\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_HTTP_SCHEMA<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_PORT<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\">data<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_CERTIFICATE<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The InfiniBand Fabric manages a single pool of GUIDs. In order to use IB Kubernetes in different clusters, different GUID ranges must be specified to avoid collisions.</p> </div></div> <h2 id=\"secondary_network\">Secondary Network</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy Secondary Network</td> </tr> </tbody> </table> <p>Specifies components to deploy in order to facilitate a secondary network in Kubernetes. It consists of the following optionally deployed components:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/multus-cni\" target=\"_self\">Multus-CNI</a>: Delegate CNI plugin to support secondary networks in Kubernetes</p></li> <li class=\"has-marker\"><p>CNI plugins: Currently only <a class=\"reference external\" href=\"https://github.com/containernetworking/plugins\" target=\"_self\">containernetworking-plugins</a> is supported</p></li> <li class=\"has-marker\"><p>IPAM CNI: Currently only <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/whereabouts\" target=\"_self\">Whereabout IPAM CNI</a> is supported as a part of the secondaryNetwork section. NVIDIA-IPAM is configured separately.</p></li> <li class=\"has-marker\"><p><a class=\"reference external\" href=\"https://github.com/Mellanox/ipoib-cni\" target=\"_self\">IPoIB CNI</a>: Allows the user to create IPoIB child link and move it to the pod</p></li> </ul> <h2 id=\"cni_plugin\">CNI Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.cniPlugins.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy CNI Plugins Secondary Network</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.cniPlugins.image</td> <td>String</td> <td>plugins</td> <td>CNI Plugins image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.cniPlugins.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>CNI Plugins image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.cniPlugins.version</td> <td>String</td> <td>v1.3.0-amd64</td> <td>CNI Plugins image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.cniPlugins.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the CNI Plugins images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.cniPlugins.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"cni-plugins\">cni-plugins</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"id7\">Multus CNI</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy Multus Secondary Network</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.multus.image</td> <td>String</td> <td>multus-cni</td> <td>Multus image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>Multus image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.multus.version</td> <td>String</td> <td>v3.9.3</td> <td>Multus image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the Multus images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.multus.config</td> <td>String</td> <td>“”</td> <td>Multus CNI config. If empty, the config will be automatically generated from the CNI configuration file of the master plugin (the first file in lexicographical order in the cni-confg-dir).</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"kube-multus\">kube-multus</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"id9\">IPoIB CNI</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipoib.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy IPoIB CNI</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipoib.image</td> <td>String</td> <td>ipoib-cni</td> <td>IPoIB CNI image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipoib.repository</td> <td>String</td> <td>“”</td> <td>IPoIB CNI image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipoib.version</td> <td>String</td> <td>428715a57c0b633e48ec7620f6e3af6863149ccf</td> <td>IPoIB CNI image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipoib.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the IPoIB CNI images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipoib.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"ipoib-cni\">ipoib-cni</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"ipam_cni_plugin\">IPAM CNI Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipamPlugin.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy IPAM CNI Plugin Secondary Network</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipamPlugin.image</td> <td>String</td> <td>whereabouts</td> <td>IPAM CNI Plugin image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipamPlugin.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>IPAM CNI Plugin image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipamPlugin.version</td> <td>String</td> <td>v0.7.0-amd64</td> <td>IPAM CNI Plugin image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipamPlugin.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the IPAM CNI Plugin images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipamPlugin.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"whereabouts\">whereabouts</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"nvidia_ipam_plugin\">NVIDIA IPAM Plugin</h2><p><a class=\"reference external\" href=\"https://github.com/Mellanox/nvidia-k8s-ipam\" target=\"_self\">NVIDIA IPAM Plugin</a> is recommended to be used on large-scale deployments of the NVIDIA Network Operator.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>nvIpam.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy NVIDIA IPAM Plugin</td> </tr> <tr class=\"row-odd\"><td>nvIpam.image</td> <td>String</td> <td>nvidia-k8s-ipam</td> <td>NVIDIA IPAM Plugin image name</td> </tr> <tr class=\"row-even\"><td>nvIpam.repository</td> <td>String</td> <td>ghcr.io/mellanox</td> <td>NVIDIA IPAM Plugin image repository</td> </tr> <tr class=\"row-odd\"><td>nvIpam.version</td> <td>String</td> <td>v0.1.2</td> <td>NVIDIA IPAM Plugin image version</td> </tr> <tr class=\"row-even\"><td>nvIpam.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the Plugin images</td> </tr> <tr class=\"row-odd\"><td>nvIpam.enableWebhook</td> <td>Bool</td> <td>false</td> <td>Enable deployment of the validataion webhook for IPPool CRD</td> </tr> <tr class=\"row-even\"><td>nvIpam.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"nv-ipam-node\">nv-ipam-node</bsp-code-inline> and <bsp-code-inline code=\"nv-ipam-controller\">nv-ipam-controller</bsp-code-inline> containers</td> </tr> </tbody> </table> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Supported X.509 certificate management system should be available in the cluster to enable the validation webhook. Currently, the supported systems are <a class=\"reference external\" href=\"https://cert-manager.io/\" target=\"_self\">certmanager</a> and <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/security/certificates/service-serving-certificate.html\" target=\"_self\">Openshift certificate management</a>.</p> </div></div> <h2 id=\"nvidia_nic_feature_discovery\">NVIDIA NIC Feature Discovery</h2><p><a class=\"reference external\" href=\"https://github.com/Mellanox/nic-feature-discovery\" target=\"_self\">NVIDIA NIC Feature Discovery</a> leverages <a class=\"reference external\" href=\"https://kubernetes-sigs.github.io/node-feature-discovery/stable/get-started/index.html\" target=\"_self\">Node Feature Discovery</a> to advertise NIC specific labels on K8s Node objects.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>nicFeatureDiscovery.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy NVIDIA NIC Feature Discovery</td> </tr> <tr class=\"row-odd\"><td>nicFeatureDiscovery.image</td> <td>String</td> <td>nic-feature-discovery</td> <td>NVIDIA NIC Feature Discovery image name</td> </tr> <tr class=\"row-even\"><td>nicFeatureDiscovery.repository</td> <td>String</td> <td>ghcr.io/mellanox</td> <td>NVIDIA NIC Feature Discovery repository</td> </tr> <tr class=\"row-odd\"><td>nicFeatureDiscovery.version</td> <td>String</td> <td>v0.0.1</td> <td>NVIDIA NIC Feature Discovery image version</td> </tr> <tr class=\"row-even\"><td>nicFeatureDiscovery.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"nic-feature-discovery\">nic-feature-discovery</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"doca_telemetry_service\">DOCA Telemetry Service</h2><p><a class=\"reference external\" href=\"https://catalog.ngc.nvidia.com/orgs/nvidia/teams/doca/containers/doca_telemetry\" target=\"_self\">DOCA Telemetry Service</a> exports metrics from NVIDIA NICs on K8s Nodes.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>docaTelemetryService.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy DOCA Telemetry Service</td> </tr> <tr class=\"row-odd\"><td>docaTelemetryService.image</td> <td>String</td> <td>doca_telemetry</td> <td>DOCA Telemetry Service image name</td> </tr> <tr class=\"row-even\"><td>docaTelemetryService.repository</td> <td>String</td> <td>nvcr.io/nvidia/doca</td> <td>DOCA Telemetry Service image repository</td> </tr> <tr class=\"row-odd\"><td>docaTelemetryService.version</td> <td>String</td> <td>1.16.5-doca2.6.0-host</td> <td>DOCA Telemetry Service image version</td> </tr> <tr class=\"row-even\"><td>docaTelemetryService.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"doca-telemetry-service\">doca-telemetry-service</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"helm_customization_file\">Helm customization file</h2><div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Since several parameters should be provided when creating custom resources during operator deployment, it is recommended to use a configuration file. While it is possible to override the parameters via CLI, we recommend to avoid the use of CLI arguments in favor of a configuration file.</p> </div></div> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ helm install -f ./values.yaml -n nvidia-network-operator --create-namespace --wait nvidia/network-operator network-operator</div></pre></div> </div></body></html>",
                        "topicPages": [],
                        "date": "08/08/2024"
                    },
                    {
                        "title": "CRDs",
                        "topicId": "crds",
                        "figures": [],
                        "copyright": "© Copyright 2024, NVIDIA.",
                        "table": [],
                        "body": "<html><head></head><body><div> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#nicclusterpolicy_crd\">NicClusterPolicy CRD</a></p></li> <li class=\"has-marker\"><p><a href=\"#macvlannetwork_crd\">MacVlanNetwork CRD</a></p></li> <li class=\"has-marker\"><p><a href=\"#hostdevicenetwork_crd\">HostDeviceNetwork CRD</a></p></li> <li class=\"has-marker\"><p><a href=\"#ipoibnetwork_crd\">IPoIBNetwork CRD</a></p></li> </ul> <br><h2 id=\"nicclusterpolicy_crd\">NicClusterPolicy CRD</h2><p>To change <bsp-code-inline code=\"NicClusterPolicy\">NicClusterPolicy</bsp-code-inline> CRD object manually without helm you need to change <bsp-code-inline code=\"nic-cluster-policy\">nic-cluster-policy</bsp-code-inline> CR like a regular Kubernetes resource. For more information on NicClusterPolicy custom resource, please refer to the <a class=\"reference external\" href=\"https://github.com/Mellanox/network-operator#nicclusterpolicy-crd\" target=\"_self\">Network-Operator Project Sources</a>.</p> <h2 id=\"macvlannetwork_crd\">MacVlanNetwork CRD</h2><p>For more information on <cite>MacVlanNetwork</cite> custom resource, please refer to the <a class=\"reference external\" href=\"https://github.com/Mellanox/network-operator#macvlannetwork-crd\" target=\"_self\">Network-Operator Project Sources</a>.</p> <h2 id=\"hostdevicenetwork_crd\">HostDeviceNetwork CRD</h2><p>For more information on <cite>HostDeviceNetwork</cite> custom resource, please refer to the <a class=\"reference external\" href=\"https://github.com/Mellanox/network-operator#hostdevicenetwork-crd\" target=\"_self\">Network-Operator Project Sources</a>.</p> <h2 id=\"ipoibnetwork_crd\">IPoIBNetwork CRD</h2><p>For more information on <cite>IPoIBNetwork</cite> custom resource, please refer to the <a class=\"reference external\" href=\"https://github.com/Mellanox/network-operator#ipoibnetwork-crd\" target=\"_self\">Network-Operator Project Sources</a>.</p> </div></body></html>",
                        "topicPages": [{
                            "title": "Helm Chart Customization Options",
                            "topicId": "helm_chart_customization_options",
                            "figures": [],
                            "copyright": "© Copyright 2024, NVIDIA.",
                            "table": [],
                            "body": "<html><head></head><body><div><p>There are various customizations you can do to tailor the deployment of the Network Operator to your cluster needs. You can find those below.</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#general_parameters\">General Parameters</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#imagepullsecrets_customization\">ImagePullSecrets customization</a></p></li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#nfd_labels\">NFD labels</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_operator\">SR-IOV Network Operator</a></p></li> <li class=\"has-marker\"><p><a href=\"#container_resources\">Container Resources</a></p></li> <li class=\"has-marker\"><p><a href=\"#mlnx_ofed_driver\">MLNX_OFED Driver</a></p></li> <li class=\"has-marker\"><p><a href=\"#mlnx_ofed_driver_environment_variables\">MLNX_OFED Driver Environment Variables</a></p></li> <li class=\"has-marker\"><p><a href=\"#rdma_shared_device_plugin\">RDMA Shared Device Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#rdma_device_plugin_resource_configurations\">RDMA Device Plugin Resource Configurations</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_device_plugin\">SR-IOV Network Device Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#sr_iov_network_device_plugin_resource_configuration\">SR-IOV Network Device Plugin Resource Configuration</a></p></li> <li class=\"has-marker\"><p><a href=\"#ib_kubernetes\">IB Kubernetes</a></p></li> <li class=\"has-marker\"><p><a href=\"#ufm_secret\">UFM Secret</a></p></li> <li class=\"has-marker\"><p><a href=\"#secondary_network\">Secondary Network</a></p></li> <li class=\"has-marker\"><p><a href=\"#cni_plugin\">CNI Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#id7\">Multus CNI</a></p></li> <li class=\"has-marker\"><p><a href=\"#id9\">IPoIB CNI</a></p></li> <li class=\"has-marker\"><p><a href=\"#ipam_cni_plugin\">IPAM CNI Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#nvidia_ipam_plugin\">NVIDIA IPAM Plugin</a></p></li> <li class=\"has-marker\"><p><a href=\"#nvidia_nic_feature_discovery\">NVIDIA NIC Feature Discovery</a></p></li> <li class=\"has-marker\"><p><a href=\"#doca_telemetry_service\">DOCA Telemetry Service</a></p></li> <li class=\"has-marker\"><p><a href=\"#helm_customization_file\">Helm customization file</a></p></li> </ul> <br><h2 id=\"general_parameters\">General Parameters</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>operator.admissionController.enabled</td> <td>Bool</td> <td>False</td> <td>Deploy with admission controller</td> </tr> <tr class=\"row-odd\"><td>operator.admissionController.useCertManager</td> <td>Bool</td> <td>True</td> <td>Use cert-manager for generating self-signed certificate</td> </tr> <tr class=\"row-even\"><td>operator.admissionController.certificate.tlsCrt</td> <td>String</td> <td>“”</td> <td>External TLS certificate. Ignored if cert-manager is used</td> </tr> <tr class=\"row-odd\"><td>operator.admissionController.certificate.tlsKey</td> <td>String</td> <td>“”</td> <td>External TLS private key. Ignored if cert-manager is used</td> </tr> <tr class=\"row-even\"><td>nfd.enabled</td> <td>Bool</td> <td>True</td> <td>Deploy Node Feature Discovery</td> </tr> <tr class=\"row-odd\"><td>nfd.deployNodeFeatureRules</td> <td>Bool</td> <td>True</td> <td>Deploy Node Feature Rules to label the nodes</td> </tr> <tr class=\"row-even\"><td>sriovNetworkOperator.enabled</td> <td>Bool</td> <td>False</td> <td>Deploy SR-IOV Network Operator</td> </tr> <tr class=\"row-odd\"><td>sriovNetworkOperator.configDaemonNodeSelectorExtra</td> <td>List</td> <td>node-role.kubernetes.io/worker: “”</td> <td>Additional values for SR-IOV Config Daemon nodes selector</td> </tr> <tr class=\"row-even\"><td>upgradeCRDs</td> <td>Bool</td> <td>True</td> <td>Enable CRDs upgrade with helm pre-install and pre-upgrade hooks</td> </tr> <tr class=\"row-odd\"><td>operator.repository</td> <td>String</td> <td>nvcr.io/nvidia</td> <td>Network Operator image repository</td> </tr> <tr class=\"row-even\"><td>operator.image</td> <td>String</td> <td>network-operator</td> <td>Network Operator image name</td> </tr> <tr class=\"row-odd\"><td>operator.tag</td> <td>String</td> <td>None</td> <td>Network Operator image tag. If set to <bsp-code-inline code=\"None\">None</bsp-code-inline>, the chart’s <bsp-code-inline code=\"appVersion\">appVersion</bsp-code-inline> will be used</td> </tr> <tr class=\"row-even\"><td>operator.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling Network Operator image</td> </tr> <tr class=\"row-odd\"><td>operator.cniBinDirectory</td> <td>String</td> <td>/opt/cni/bin</td> <td>Directory, where CNI binaries will be deployed on the nodes. Setting for the sriov-network-operator is set with <bsp-code-inline code=\"sriov-network-operator.cniBinPath\">sriov-network-operator.cniBinPath</bsp-code-inline> parameter. Note that the CNI bin directory should be aligned with the CNI bin directory in the container runtime.</td> </tr> <tr class=\"row-even\"><td>operator.resources</td> <td>Yaml</td> <td> resources:<br> limits:<br> cpu: 500m<br> memory: 128Mi<br> <br> requests:<br> cpu: 5m<br> memory: 64Mi<br> <br> <br> <br> </td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the operator</td> </tr> <tr class=\"row-odd\"><td>imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the Network Operator image, if it is not overridden</td> </tr> <tr class=\"row-even\"><td>deployCR</td> <td>Bool</td> <td>False</td> <td>Deploy <bsp-code-inline code=\"NicClusterPolicy\">NicClusterPolicy</bsp-code-inline> custom resource according to the provided parameters</td> </tr> <tr class=\"row-odd\"><td>nodeAffinity</td> <td>Yaml</td> <td> requiredDuringSchedulingIgnoredDuringExecution:<br> nodeSelectorTerms:<br> - matchExpressions:<br> - key: node-role.kubernetes.io/master<br> operator: DoesNotExist<br> <br> - key: node-role.kubernetes.io/control-plane<br> operator: DoesNotExist<br> <br> <br> <br> <br> <br> </td> <td>Configure node affinity settings for Network Operator components</td> </tr> <tr class=\"row-even\"><td>tolerations</td> <td>Yaml</td> <td>“”</td> <td>Set additional tolerations for various Daemonsets deployed by the network operator, e.g. whereabouts, multus, cni-plugins.</td> </tr> <tr class=\"row-odd\"><td>useDTK</td> <td>Bool</td> <td>True</td> <td>Enable the use of Driver ToolKit to compile OFED drivers (OpenShift only)</td> </tr> </tbody> </table> <h3 id=\"imagepullsecrets_customization\">ImagePullSecrets customization</h3> <p>To provide <cite>imagePullSecrets`</cite> object references, you need to specify them using a following structure:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">imagePullSecrets:</div><div class=\"code-line\">  - image-pull-secret1</div><div class=\"code-line\">  - image-pull-secret2</div></pre></div> <h2 id=\"nfd_labels\">NFD labels</h2><p>The NFD labels required by the Network Operator and GPU Operator:</p> <table> <colgroup> <col style=\"width: 50%\"> <col style=\"width: 50%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Label</p></th> <th class=\"head\"><p>Location</p></th> </tr> <tr class=\"row-even\"><td>feature.node.kubernetes.io/pci-15b3.present</td> <td>Nodes containing NVIDIA Networking hardware</td> </tr> <tr class=\"row-odd\"><td>feature.node.kubernetes.io/pci-10de.present</td> <td>Nodes containing NVIDIA GPU hardware</td> </tr> </tbody> </table> <h2 id=\"sr_iov_network_operator\">SR-IOV Network Operator</h2><p>SR-IOV Network Operator Helm chart customization options can be found <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/sriov-network-operator/blob/master/deployment/sriov-network-operator/README.md\" target=\"_self\">here</a>. Following is a list of overriden values by NVIDIA Operator Helm Chart:</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default in NVIDIA Network Operator</p></th> <th class=\"head\"><p>Notes</p></th> </tr> <tr class=\"row-even\"><td>sriov-network-operator.operator.resourcePrefix</td> <td>String</td> <td>nvidia.com</td> <td></td> </tr> <tr class=\"row-odd\"><td>sriov-network-operator.images.operator</td> <td>String</td> <td>nvcr.io/nvidia/mellanox/sriov-network-operator:network-operator-24.4.0</td> <td></td> </tr> <tr class=\"row-even\"><td>sriov-network-operator.images.sriovConfigDaemon</td> <td>String</td> <td>nvcr.io/nvidia/mellanox/sriov-network-operator-config-daemon:network-operator-24.4.0</td> <td></td> </tr> <tr class=\"row-odd\"><td>sriov-network-operator.images.sriovCni</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg/sriov-cni:3e6368077716f6b8368b0e036a1290d1c64cf1fb</td> <td>For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/sriov-cni:v2.8.0-arm64\">ghcr.io/k8snetworkplumbingwg/sriov-cni:v2.8.0-arm64</bsp-code-inline> image</td> </tr> <tr class=\"row-even\"><td>sriov-network-operator.images.ibSriovCni</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:fc002af57a81855542759d0f77d16dacd7e1aa38</td> <td>For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:1.1.0-arm64\">ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:1.1.0-arm64</bsp-code-inline> image</td> </tr> <tr class=\"row-odd\"><td>sriov-network-operator.images.sriovDevicePlugin</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:e6ead1e8f76a407783430ee2666b403db2d76f64</td> <td>For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-arm64\">ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-arm64</bsp-code-inline> image</td> </tr> <tr class=\"row-even\"><td>sriov-network-operator.images.webhook</td> <td>String</td> <td>nvcr.io/nvidia/mellanox/sriov-network-operator-webhook:network-operator-24.4.0</td> <td></td> </tr> </tbody> </table> <h2 id=\"container_resources\">Container Resources</h2><p>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">requests and limits</a> can be configured for each container of the sub-resources deployed by the Network Operator by setting the parameter <bsp-code-inline code=\"containerResources\">containerResources</bsp-code-inline>.</p> <p>For example:</p> <div class=\"code-body \"><pre><div class=\"code-line\">containerResources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>\"mofed-container\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>requests<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>cpu<span class=\"p\">:</span><span class=\"w\"> </span>\"200m\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>memory<span class=\"p\">:</span><span class=\"w\"> </span>\"150Mi\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>limits<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>cpu<span class=\"p\">:</span><span class=\"w\"> </span>\"300m\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>memory<span class=\"p\">:</span><span class=\"w\"> </span>\"300Mi\"<span class=\"w\"></span></div></pre></div> <h2 id=\"mlnx_ofed_driver\">MLNX_OFED Driver</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>ofedDriver.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy the MLNX_OFED driver container</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.repository</td> <td>String</td> <td>nvcr.io/nvidia/mellanox</td> <td>MLNX_OFED driver image repository</td> </tr> <tr class=\"row-even\"><td>ofedDriver.image</td> <td>String</td> <td>doca-driver</td> <td>MLNX_OFED driver image name</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.version</td> <td>String</td> <td>24.04-0.6.6.0-0</td> <td>MLNX_OFED driver version</td> </tr> <tr class=\"row-even\"><td>ofedDriver.initContainer.enable</td> <td>Bool</td> <td>true</td> <td>Deploy init container</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.initContainer.repository</td> <td>string</td> <td>ghcr.io/mellanox</td> <td>init container image repository</td> </tr> <tr class=\"row-even\"><td>ofedDriver.initContainer.image</td> <td>string</td> <td>network-operator-init-container</td> <td>init container image name</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.initContainer.version</td> <td>string</td> <td>v0.0.2</td> <td>init container image version</td> </tr> <tr class=\"row-even\"><td>ofedDriver.certConfig.name</td> <td>String</td> <td>“”</td> <td>Custom TLS key/certificate configuration configMap name</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.repoConfig.name</td> <td>String</td> <td>“”</td> <td>Private mirror repository configuration configMap name</td> </tr> <tr class=\"row-even\"><td>ofedDriver.terminationGracePeriodSeconds</td> <td>Int</td> <td>300</td> <td>NVIDIA OFED termination grace periods in seconds</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the MLNX_OFED driver images</td> </tr> <tr class=\"row-even\"><td>ofedDriver.env</td> <td>List</td> <td>[]</td> <td>An optional list of <a class=\"reference external\" href=\"https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.29/#envvar-v1-core\" target=\"_self\">environment variables</a> passed to the NVIDIA OFED driver image</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.startupProbe.initialDelaySeconds</td> <td>Int</td> <td>10</td> <td>MLNX_OFED startup probe initial delay</td> </tr> <tr class=\"row-even\"><td>ofedDriver.startupProbe.periodSeconds</td> <td>Int</td> <td>20</td> <td>MLNX_OFED startup probe interval</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.livenessProbe.initialDelaySeconds</td> <td>Int</td> <td>30</td> <td>MLNX_OFED liveness probe initial delay</td> </tr> <tr class=\"row-even\"><td>ofedDriver.livenessProbe.periodSeconds</td> <td>Int</td> <td>30</td> <td>MLNX_OFED liveness probe interval</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.readinessProbe.initialDelaySeconds</td> <td>Int</td> <td>10</td> <td>MLNX_OFED readiness probe initial delay</td> </tr> <tr class=\"row-even\"><td>ofedDriver.readinessProbe.periodSeconds</td> <td>Int</td> <td>30</td> <td>MLNX_OFED readiness probe interval</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.autoUpgrade</td> <td>Bool</td> <td>true</td> <td>A global switch for the automatic upgrade feature. If set to false, all other options are ignored.</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.maxParallelUpgrades</td> <td>Int</td> <td>1</td> <td>The amount of nodes that can be upgraded in parallel. 0 means no limit. All nodes will be upgraded in parallel.</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.safeLoad</td> <td>Bool</td> <td>false</td> <td>Cordon and drain (if enabled) a node before loading the driver on it, requires <bsp-code-inline code=\"ofedDriver.initContainer\">ofedDriver.initContainer</bsp-code-inline> to be enabled and <bsp-code-inline code=\"ofedDriver.upgradePolicy.autoUpgrade\">ofedDriver.upgradePolicy.autoUpgrade</bsp-code-inline> to be true</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.drain.enable</td> <td>Bool</td> <td>true</td> <td>Options for node drain (<bsp-code-inline code=\"kubectl drain\">kubectl drain</bsp-code-inline>) before driver reload, if auto upgrade is enabled.</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.drain.force</td> <td>Bool</td> <td>true</td> <td>Use force drain of pods</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.drain.podSelector</td> <td>String</td> <td>“”</td> <td>Pod selector to specify which pods will be drained from the node. An empty selector means all pods.</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.drain.timeoutSeconds</td> <td>Int</td> <td>300</td> <td>Number of seconds to wait for pod eviction</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.drain.deleteEmptyDir</td> <td>Bool</td> <td>false</td> <td>Delete pods local storage</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.upgradePolicy.waitForCompletion.podSelector</td> <td>String</td> <td>Not set</td> <td>Specifies a label selector for the pods to wait for completion before starting the driver upgrade</td> </tr> <tr class=\"row-even\"><td>ofedDriver.upgradePolicy.waitForCompletion.timeoutSeconds</td> <td>int</td> <td>Not set</td> <td>Specify the length of time in seconds to wait before giving up for workload to finish. Zero means infinite</td> </tr> <tr class=\"row-odd\"><td>ofedDriver.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> and limits for the <bsp-code-inline code=\"mofed-container\">mofed-container</bsp-code-inline></td> </tr> <tr class=\"row-even\"><td>ofedDriver.forcePrecompiled</td> <td>Bool</td> <td>false</td> <td>Fail Mellanox OFED deployment if precompiled OFED driver container image does not exists</td> </tr> </tbody> </table> <h2 id=\"mlnx_ofed_driver_environment_variables\">MLNX_OFED Driver Environment Variables</h2><p>The following are special environment variables supported by the MLNX_OFED container to configure its behavior:</p> <table> <colgroup> <col style=\"width: 33%\"> <col style=\"width: 33%\"> <col style=\"width: 33%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>CREATE_IFNAMES_UDEV</td> <td> * “true” for Ubuntu 20.04, RHEL v8.x and OCP &lt;= v4.13.<br> * “false” for newer OS.<br> <br> </td> <td>Create an udev rule to preserve “old-style” path based netdev names e.g enp3s0f0</td> </tr> <tr class=\"row-odd\"><td>UNLOAD_STORAGE_MODULES</td> <td>“false”</td> <td> Unload host storage modules prior to loading MLNX_OFED modules:<br> * ib_isert<br> * nvme_rdma<br> * nvmet_rdma<br> * rpcrdma<br> * xprtrdma<br> * ib_srpt<br> <br> <br> </td> </tr> <tr class=\"row-even\"><td>ENABLE_NFSRDMA</td> <td>“false”</td> <td>Enable loading of NFS related storage modules from a MLNX_OFED container</td> </tr> <tr class=\"row-odd\"><td>RESTORE_DRIVER_ON_POD_TERMINATION</td> <td>“true”</td> <td>Restore host drivers when a container</td> </tr> </tbody> </table> <p>In addition, it is possible to specify any environment variables to be exposed to the MLNX_OFED container, such as the standard “HTTP_PROXY”, “HTTPS_PROXY”, “NO_PROXY”.</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>CREATE_IFNAMES_UDEV is set automatically by the Network Operator, depending on the Operating System of the worker nodes in the cluster (the cluster is assumed to be homogenous).</p> </div></div> <p>To set these variables, change them into Helm values. For example:</p> <div class=\"code-body \"><pre><div class=\"code-line\">ofedDriver<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>env<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>RESTORE_DRIVER_ON_POD_TERMINATION<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>value<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>UNLOAD_STORAGE_MODULES<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>value<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>CREATE_IFNAMES_UDEV<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">    </span>value<span class=\"p\">:</span><span class=\"w\"> </span>\"true\"<span class=\"w\"></span></div></pre></div> <p>The variables can also be configured directly via the NicClusterPolicy CRD.</p> <h2 id=\"rdma_shared_device_plugin\">RDMA Shared Device Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy RDMA shared device plugin</td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.repository</td> <td>String</td> <td>nvcr.io/nvidia/cloud-native</td> <td>RDMA shared device plugin image repository</td> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.image</td> <td>String</td> <td>k8s-rdma-shared-dev-plugin</td> <td>RDMA shared device plugin image name</td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.version</td> <td>String</td> <td>1.4.0</td> <td>RDMA shared device plugin version</td> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the RDMA Shared device plugin image</td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.resources</td> <td>List</td> <td>See below</td> <td>RDMA shared device plugin resources</td> </tr> <tr class=\"row-even\"><td>rdmaSharedDevicePlugin.useCdi</td> <td>Bool</td> <td>false</td> <td> Enable Container Device Interface (CDI) mode.<br> <b>NOTE</b>: NVIDIA Network Operator does not configure container runtime to enable CDI<br> <br> </td> </tr> <tr class=\"row-odd\"><td>rdmaSharedDevicePlugin.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"rdma-shared-dp\">rdma-shared-dp</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"rdma_device_plugin_resource_configurations\">RDMA Device Plugin Resource Configurations</h2><p>These configurations consist of a list of RDMA resources, each with a name and a selector of RDMA capable network devices to be associated with the resource. Refer to <a class=\"reference external\" href=\"https://github.com/Mellanox/k8s-rdma-shared-dev-plugin#devices-selectors\" target=\"_self\">RDMA Shared Device Plugin Selectors</a> for supported selectors.</p> <div class=\"code-body \"><pre><div class=\"code-line\">resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_a<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceIDs<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>1017<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>enp5s0f0<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>rdmaHcaMax<span class=\"p\">:</span><span class=\"w\"> </span>63<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>rdma_shared_device_b<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>deviceIDs<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>1017<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>ifNames<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ib0<span class=\"p p-Indicator\">,</span><span class=\"w\"> </span>ib1<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>rdmaHcaMax<span class=\"p\">:</span><span class=\"w\"> </span>63<span class=\"w\"></span></div></pre></div> <h2 id=\"sr_iov_network_device_plugin\">SR-IOV Network Device Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy SR-IOV Network device plugin</td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>SR-IOV Network device plugin image repository</td> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.image</td> <td>String</td> <td>sriov-network-device-plugin</td> <td>SR-IOV Network device plugin image name</td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.version</td> <td>String</td> <td>e6ead1e8f76a407783430ee2666b403db2d76f64</td> <td> SR-IOV Network device plugin version<br> For ARM-based deployments, it is recommended to use the <bsp-code-inline code=\"ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-amd64\">ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:v3.6.2-amd64</bsp-code-inline> image<br> <br> </td> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the SR-IOV Network device plugin image</td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.resources</td> <td>List</td> <td>See below</td> <td>SR-IOV Network device plugin resources</td> </tr> <tr class=\"row-even\"><td>sriovDevicePlugin.useCdi</td> <td>Bool</td> <td>false</td> <td> Enable Container Device Interface (CDI) mode.<br> <b>NOTE</b>: NVIDIA Network Operator does not configure container runtime to enable CD.<br> <br> </td> </tr> <tr class=\"row-odd\"><td>sriovDevicePlugin.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"kube-sriovdp\">kube-sriovdp</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"sr_iov_network_device_plugin_resource_configuration\">SR-IOV Network Device Plugin Resource Configuration</h2><p>Consists of a list of RDMA resources, each with a name and a selector of RDMA capable network devices to be associated with the resource. Refer to <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin#device-selectors\" target=\"_self\">SR-IOV Network Device Plugin Selectors</a> for supported selectors.</p> <div class=\"code-body \"><pre><div class=\"code-line\">resources<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>hostdev<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ethernet_rdma<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>linkTypes<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>ether<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"p p-Indicator\">-</span><span class=\"w\"> </span>name<span class=\"p\">:</span><span class=\"w\"> </span>sriov_rdma<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>vendors<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>15b3<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>devices<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>1018<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>drivers<span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p p-Indicator\">[</span>mlx5_ib<span class=\"p p-Indicator\">]</span><span class=\"w\"></span></div></pre></div> <h2 id=\"ib_kubernetes\">IB Kubernetes</h2><p>ib-kubernetes provides a daemon that works in conjunction with the <a class=\"reference external\" href=\"https://github.com/openshift/sriov-network-operator\" target=\"_self\">SR-IOV Network Device Plugin</a>. It acts on Kubernetes pod object changes (Create/Update/Delete), reading the pod’s network annotation, fetching its corresponding network CRD and reading the PKey. This is done in order to add the newly generated GUID or the predefined GUID in the GUID field of the CRD cni-args to that PKey for pods with <bsp-code-inline code=\"mellanox.infiniband.app\">mellanox.infiniband.app</bsp-code-inline> annotation.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>ibKubernetes.deploy</td> <td>bool</td> <td>false</td> <td>Deploy IB Kubernetes</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.repository</td> <td>string</td> <td>ghcr.io/mellanox</td> <td>IB Kubernetes image repository</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.image</td> <td>string</td> <td>ib-kubernetes</td> <td>IB Kubernetes image name</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.version</td> <td>string</td> <td>v1.0.2</td> <td>IB Kubernetes version</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.imagePullSecrets</td> <td>list</td> <td>[]</td> <td>An optional list of references to secrets used for pulling any of the IB Kubernetes images</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.periodicUpdateSeconds</td> <td>int</td> <td>5</td> <td>Interval of periodic update in seconds</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.pKeyGUIDPoolRangeStart</td> <td>string</td> <td>02:00:00:00:00:00:00:00</td> <td>Minimal available GUID value to be allocated for the pod</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.pKeyGUIDPoolRangeEnd</td> <td>string</td> <td>02:FF:FF:FF:FF:FF:FF:FF</td> <td>Maximal available GUID value to be allocated for the pod</td> </tr> <tr class=\"row-even\"><td>ibKubernetes.ufmSecret</td> <td>string</td> <td>See below</td> <td>Name of the Secret with the NVIDIA UFM access credentials, deployed in advance</td> </tr> <tr class=\"row-odd\"><td>ibKubernetes.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"ib-kubernetes\">ib-kubernetes</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"ufm_secret\">UFM Secret</h2><p>IB Kubernetes must access <a class=\"reference external\" href=\"https://www.nvidia.com/en-us/networking/infiniband/ufm/\" target=\"_self\">NVIDIA UFM</a> in order to manage pods’ GUIDs. To provide its credentials, the secret of the following format should be deployed in advance:</p> <div class=\"code-body \"><pre><div class=\"code-line\">apiVersion<span class=\"p\">:</span><span class=\"w\"> </span>v1<span class=\"w\"></span></div><div class=\"code-line\">kind<span class=\"p\">:</span><span class=\"w\"> </span>Secret<span class=\"w\"></span></div><div class=\"code-line\">metadata<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>name<span class=\"p\">:</span><span class=\"w\"> </span>ib-kubernetes-ufm-secret<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>namespace<span class=\"p\">:</span><span class=\"w\"> </span>nvidia-network-operator<span class=\"w\"></span></div><div class=\"code-line\">stringData<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_USERNAME<span class=\"p\">:</span><span class=\"w\"> </span>\"admin\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_PASSWORD<span class=\"p\">:</span><span class=\"w\"> </span>\"123456\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_ADDRESS<span class=\"p\">:</span><span class=\"w\"> </span>\"ufm-hostname\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_HTTP_SCHEMA<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_PORT<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div><div class=\"code-line\">data<span class=\"p\">:</span><span class=\"w\"></span></div><div class=\"code-line\"><span class=\"w\">  </span>UFM_CERTIFICATE<span class=\"p\">:</span><span class=\"w\"> </span>\"\"<span class=\"w\"></span></div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The InfiniBand Fabric manages a single pool of GUIDs. In order to use IB Kubernetes in different clusters, different GUID ranges must be specified to avoid collisions.</p> </div></div> <h2 id=\"secondary_network\">Secondary Network</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy Secondary Network</td> </tr> </tbody> </table> <p>Specifies components to deploy in order to facilitate a secondary network in Kubernetes. It consists of the following optionally deployed components:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/multus-cni\" target=\"_self\">Multus-CNI</a>: Delegate CNI plugin to support secondary networks in Kubernetes</p></li> <li class=\"has-marker\"><p>CNI plugins: Currently only <a class=\"reference external\" href=\"https://github.com/containernetworking/plugins\" target=\"_self\">containernetworking-plugins</a> is supported</p></li> <li class=\"has-marker\"><p>IPAM CNI: Currently only <a class=\"reference external\" href=\"https://github.com/k8snetworkplumbingwg/whereabouts\" target=\"_self\">Whereabout IPAM CNI</a> is supported as a part of the secondaryNetwork section. NVIDIA-IPAM is configured separately.</p></li> <li class=\"has-marker\"><p><a class=\"reference external\" href=\"https://github.com/Mellanox/ipoib-cni\" target=\"_self\">IPoIB CNI</a>: Allows the user to create IPoIB child link and move it to the pod</p></li> </ul> <h2 id=\"cni_plugin\">CNI Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.cniPlugins.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy CNI Plugins Secondary Network</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.cniPlugins.image</td> <td>String</td> <td>plugins</td> <td>CNI Plugins image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.cniPlugins.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>CNI Plugins image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.cniPlugins.version</td> <td>String</td> <td>v1.3.0-amd64</td> <td>CNI Plugins image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.cniPlugins.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the CNI Plugins images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.cniPlugins.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"cni-plugins\">cni-plugins</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"id7\">Multus CNI</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy Multus Secondary Network</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.multus.image</td> <td>String</td> <td>multus-cni</td> <td>Multus image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>Multus image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.multus.version</td> <td>String</td> <td>v3.9.3</td> <td>Multus image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the Multus images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.multus.config</td> <td>String</td> <td>“”</td> <td>Multus CNI config. If empty, the config will be automatically generated from the CNI configuration file of the master plugin (the first file in lexicographical order in the cni-confg-dir).</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.multus.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"kube-multus\">kube-multus</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"id9\">IPoIB CNI</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipoib.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy IPoIB CNI</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipoib.image</td> <td>String</td> <td>ipoib-cni</td> <td>IPoIB CNI image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipoib.repository</td> <td>String</td> <td>“”</td> <td>IPoIB CNI image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipoib.version</td> <td>String</td> <td>428715a57c0b633e48ec7620f6e3af6863149ccf</td> <td>IPoIB CNI image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipoib.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the IPoIB CNI images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipoib.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"ipoib-cni\">ipoib-cni</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"ipam_cni_plugin\">IPAM CNI Plugin</h2><table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipamPlugin.deploy</td> <td>Bool</td> <td>true</td> <td>Deploy IPAM CNI Plugin Secondary Network</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipamPlugin.image</td> <td>String</td> <td>whereabouts</td> <td>IPAM CNI Plugin image name</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipamPlugin.repository</td> <td>String</td> <td>ghcr.io/k8snetworkplumbingwg</td> <td>IPAM CNI Plugin image repository</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipamPlugin.version</td> <td>String</td> <td>v0.7.0-amd64</td> <td>IPAM CNI Plugin image version</td> </tr> <tr class=\"row-even\"><td>secondaryNetwork.ipamPlugin.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the IPAM CNI Plugin images</td> </tr> <tr class=\"row-odd\"><td>secondaryNetwork.ipamPlugin.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"whereabouts\">whereabouts</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"nvidia_ipam_plugin\">NVIDIA IPAM Plugin</h2><p><a class=\"reference external\" href=\"https://github.com/Mellanox/nvidia-k8s-ipam\" target=\"_self\">NVIDIA IPAM Plugin</a> is recommended to be used on large-scale deployments of the NVIDIA Network Operator.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>nvIpam.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy NVIDIA IPAM Plugin</td> </tr> <tr class=\"row-odd\"><td>nvIpam.image</td> <td>String</td> <td>nvidia-k8s-ipam</td> <td>NVIDIA IPAM Plugin image name</td> </tr> <tr class=\"row-even\"><td>nvIpam.repository</td> <td>String</td> <td>ghcr.io/mellanox</td> <td>NVIDIA IPAM Plugin image repository</td> </tr> <tr class=\"row-odd\"><td>nvIpam.version</td> <td>String</td> <td>v0.1.2</td> <td>NVIDIA IPAM Plugin image version</td> </tr> <tr class=\"row-even\"><td>nvIpam.imagePullSecrets</td> <td>List</td> <td>[]</td> <td>An optional list of references to secrets to use for pulling any of the Plugin images</td> </tr> <tr class=\"row-odd\"><td>nvIpam.enableWebhook</td> <td>Bool</td> <td>false</td> <td>Enable deployment of the validataion webhook for IPPool CRD</td> </tr> <tr class=\"row-even\"><td>nvIpam.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"nv-ipam-node\">nv-ipam-node</bsp-code-inline> and <bsp-code-inline code=\"nv-ipam-controller\">nv-ipam-controller</bsp-code-inline> containers</td> </tr> </tbody> </table> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Supported X.509 certificate management system should be available in the cluster to enable the validation webhook. Currently, the supported systems are <a class=\"reference external\" href=\"https://cert-manager.io/\" target=\"_self\">certmanager</a> and <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/latest/security/certificates/service-serving-certificate.html\" target=\"_self\">Openshift certificate management</a>.</p> </div></div> <h2 id=\"nvidia_nic_feature_discovery\">NVIDIA NIC Feature Discovery</h2><p><a class=\"reference external\" href=\"https://github.com/Mellanox/nic-feature-discovery\" target=\"_self\">NVIDIA NIC Feature Discovery</a> leverages <a class=\"reference external\" href=\"https://kubernetes-sigs.github.io/node-feature-discovery/stable/get-started/index.html\" target=\"_self\">Node Feature Discovery</a> to advertise NIC specific labels on K8s Node objects.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>nicFeatureDiscovery.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy NVIDIA NIC Feature Discovery</td> </tr> <tr class=\"row-odd\"><td>nicFeatureDiscovery.image</td> <td>String</td> <td>nic-feature-discovery</td> <td>NVIDIA NIC Feature Discovery image name</td> </tr> <tr class=\"row-even\"><td>nicFeatureDiscovery.repository</td> <td>String</td> <td>ghcr.io/mellanox</td> <td>NVIDIA NIC Feature Discovery repository</td> </tr> <tr class=\"row-odd\"><td>nicFeatureDiscovery.version</td> <td>String</td> <td>v0.0.1</td> <td>NVIDIA NIC Feature Discovery image version</td> </tr> <tr class=\"row-even\"><td>nicFeatureDiscovery.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"nic-feature-discovery\">nic-feature-discovery</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"doca_telemetry_service\">DOCA Telemetry Service</h2><p><a class=\"reference external\" href=\"https://catalog.ngc.nvidia.com/orgs/nvidia/teams/doca/containers/doca_telemetry\" target=\"_self\">DOCA Telemetry Service</a> exports metrics from NVIDIA NICs on K8s Nodes.</p> <table> <colgroup> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> <col style=\"width: 25%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Type</p></th> <th class=\"head\"><p>Default</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>docaTelemetryService.deploy</td> <td>Bool</td> <td>false</td> <td>Deploy DOCA Telemetry Service</td> </tr> <tr class=\"row-odd\"><td>docaTelemetryService.image</td> <td>String</td> <td>doca_telemetry</td> <td>DOCA Telemetry Service image name</td> </tr> <tr class=\"row-even\"><td>docaTelemetryService.repository</td> <td>String</td> <td>nvcr.io/nvidia/doca</td> <td>DOCA Telemetry Service image repository</td> </tr> <tr class=\"row-odd\"><td>docaTelemetryService.version</td> <td>String</td> <td>1.16.5-doca2.6.0-host</td> <td>DOCA Telemetry Service image version</td> </tr> <tr class=\"row-even\"><td>docaTelemetryService.containerResources</td> <td>List</td> <td>Not set</td> <td>Optional <a class=\"reference external\" href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/\" target=\"_self\">resource requests and limits</a> for the <bsp-code-inline code=\"doca-telemetry-service\">doca-telemetry-service</bsp-code-inline> container</td> </tr> </tbody> </table> <h2 id=\"helm_customization_file\">Helm customization file</h2><div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Since several parameters should be provided when creating custom resources during operator deployment, it is recommended to use a configuration file. While it is possible to override the parameters via CLI, we recommend to avoid the use of CLI arguments in favor of a configuration file.</p> </div></div> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ helm install -f ./values.yaml -n nvidia-network-operator --create-namespace --wait nvidia/network-operator network-operator</div></pre></div> </div></body></html>",
                            "topicPages": [],
                            "date": "08/08/2024"
                        }],
                        "date": "08/08/2024"
                    }
                ],
                "date": "08/08/2024"
            },
            {
                "title": "Life Cycle Management",
                "topicId": "life_cycle_management",
                "figures": [],
                "copyright": "© Copyright 2024, NVIDIA.",
                "table": [],
                "body": "<html><head></head><body><div> <p class=\"topic-title\">On this page</p> <ul class=\"simple\"> <li class=\"has-marker\"><p><a href=\"#ensuring_deployment_readiness\">Ensuring Deployment Readiness</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#status_field_example_of_a_nicclusterpolicy_instance\">Status Field Example of a NICClusterPolicy Instance</a></p></li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#network_operator_upgrade\">Network Operator Upgrade</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#downloading_a_new_helm_chart\">Downloading a New Helm Chart</a></p></li> <li class=\"has-marker\"><p><a href=\"#upgrading_crds_for_a_specific_release\">Upgrading CRDs for a Specific Release</a></p></li> <li class=\"has-marker\"><p><a href=\"#preparing_the_helm_values_for_the_new_release\">Preparing the Helm Values for the New Release</a></p></li> <li class=\"has-marker\"><p><a href=\"#applying_the_helm_chart_update\">Applying the Helm Chart Update</a></p></li> <li class=\"has-marker\"><p><a href=\"#ofed_driver_manual_upgrade\">OFED Driver Manual Upgrade</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#restarting_pods_with_a_containerized_ofed_driver\">Restarting Pods with a Containerized OFED Driver</a></p></li> <li class=\"has-marker\"><p><a href=\"#removing_pods_with_a_secondary_network_from_the_node\">Removing Pods with a Secondary Network from the Node</a></p></li> <li class=\"has-marker\"><p><a href=\"#restarting_the_ofed_driver_pod\">Restarting the OFED Driver Pod</a></p></li> <li class=\"has-marker\"><p><a href=\"#deleting_the_ofed_driver_pod_from_the_node\">Deleting the OFED Driver Pod from the Node</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#returning_pods_with_a_secondary_network_to_the_node\">Returning Pods with a Secondary Network to the Node</a></p></li> </ul> </li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#automatic_ofed_driver_upgrade\">Automatic OFED Driver Upgrade</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#node_upgrade_states\">Node Upgrade States</a></p></li> <li class=\"has-marker\"><p><a href=\"#safe_driver_loading\">Safe Driver Loading</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#troubleshooting\">Troubleshooting</a></p></li> </ul> </li> </ul> </li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#uninstalling_the_network_operator\">Uninstalling the Network Operator</a></p> <ul> <li class=\"has-marker\"><p><a href=\"#uninstalling_network_operator_on_a_vanilla_kubernetes_cluster\">Uninstalling Network Operator on a Vanilla Kubernetes Cluster</a></p></li> <li class=\"has-marker\"><p><a href=\"#uninstalling_the_network_operator_on_an_openshift_cluster\">Uninstalling the Network Operator on an OpenShift Cluster</a></p></li> <li class=\"has-marker\"><p><a href=\"#additional_steps\">Additional Steps</a></p></li> </ul> </li> <li class=\"has-marker\"><p><a href=\"#nicclusterpolicy_crd_update\">NicClusterPolicy CRD Update</a></p></li> </ul> <br><h2 id=\"ensuring_deployment_readiness\">Ensuring Deployment Readiness</h2><p>Once the Network Operator is deployed, and a NicClusterPolicy resource is created, the operator will reconcile the state of the cluster until it reaches the desired state, as defined in the resource.</p> <p>Alignment of the cluster to the defined policy can be verified in the custom resource status.</p> <p>a “Ready” state indicates that the required components were deployed, and that the policy is applied on the cluster.</p> <h3 id=\"status_field_example_of_a_nicclusterpolicy_instance\">Status Field Example of a NICClusterPolicy Instance</h3> <p>Get the NicClusterPolicy status:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl get -n nvidia-network-operator nicclusterpolicies.mellanox.com nic-cluster-policy -o yaml</div></pre></div> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">status:</div><div class=\"code-line\">  appliedStates:</div><div class=\"code-line\">  - name: state-pod-security-policy</div><div class=\"code-line\">    state: ignore</div><div class=\"code-line\">  - name: state-multus-cni</div><div class=\"code-line\">    state: ready</div><div class=\"code-line\">  - name: state-container-networking-plugins</div><div class=\"code-line\">    state: ignore</div><div class=\"code-line\">  - name: state-ipoib-cni</div><div class=\"code-line\">    state: ignore</div><div class=\"code-line\">  - name: state-whereabouts-cni</div><div class=\"code-line\">    state: ready</div><div class=\"code-line\">  - name: state-OFED</div><div class=\"code-line\">    state: ready</div><div class=\"code-line\">  - name: state-SRIOV-device-plugin</div><div class=\"code-line\">    state: ignore</div><div class=\"code-line\">  - name: state-RDMA-device-plugin</div><div class=\"code-line\">    state: ready</div><div class=\"code-line\">  - name: state-NV-Peer</div><div class=\"code-line\">    state: ignore</div><div class=\"code-line\">  - name: state-ib-kubernetes</div><div class=\"code-line\">    state: ignore</div><div class=\"code-line\">  - name: state-nv-ipam-cni</div><div class=\"code-line\">    state: ready</div><div class=\"code-line\">  state: ready</div></pre></div> <div class=\"call-out-box option-note\"><div class=\"call-out-box-title\"> Note </div><div class=\"call-out-box-body\"> <p>An “Ignore” state indicates that the sub-state was not defined in the custom resource, and thus, it is ignored.</p> </div></div> <h2 id=\"network_operator_upgrade\">Network Operator Upgrade</h2><p>Before upgrading to Network Operator v1.0 or newer with SR-IOV Network Operator enabled, the following manual actions are required:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl -n nvidia-network-operator scale deployment network-operator-sriov-network-operator --replicas 0</div><div class=\"code-line\"></div><div class=\"code-line\">$ kubectl -n nvidia-network-operator delete sriovnetworknodepolicies.sriovnetwork.openshift.io default</div></pre></div> <p>The network operator provides limited upgrade capabilities, which require additional manual actions if a containerized OFED driver is used. Future releases of the network operator will provide an automatic upgrade flow for the containerized driver.</p> <p>Since Helm does not support auto-upgrade of existing CRDs, the user must follow a two-step process to upgrade the network-operator release:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>Upgrade the CRD to the latest version</p></li> <li class=\"has-marker\"><p>Apply Helm chart update</p></li> </ul> <h3 id=\"downloading_a_new_helm_chart\">Downloading a New Helm Chart</h3> <p>To obtain new releases, run:</p> # Download Helm chart $ helm fetch https://helm.ngc.nvidia.com/nvidia/charts/network-operator-24.4.0.tgz $ ls network-operator-*.tgz | xargs -n 1 tar xf <h3 id=\"upgrading_crds_for_a_specific_release\">Upgrading CRDs for a Specific Release</h3> <p>It is possible to retrieve updated CRDs from the Helm chart or from the release branch on GitHub. The example below shows how to upgrade CRDs from the downloaded chart.</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl apply \\</div><div class=\"code-line\">  -f network-operator/crds \\</div><div class=\"code-line\">  -f network-operator/charts/sriov-network-operator/crds</div></pre></div> <h3 id=\"preparing_the_helm_values_for_the_new_release\">Preparing the Helm Values for the New Release</h3> <p>Edit the values-&lt;VERSION&gt;.yaml file as required for your cluster. The network operator has some limitations as to which updates in the NicClusterPolicy it can handle automatically. If the configuration for the new release is different from the current configuration in the deployed release, some additional manual actions may be required.</p> <p>Known limitations:</p> <ul class=\"simple\"> <li class=\"has-marker\"><p>If component configuration was removed from the NicClusterPolicy, manual clean up of the component’s resources (DaemonSets, ConfigMaps, etc.) may be required.</p></li> <li class=\"has-marker\"><p>If the configuration for devicePlugin changed without image upgrade, manual restart of the devicePlugin may be required.</p></li> </ul> <p>These limitations will be addressed in future releases.</p> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Changes that were made directly in the NicClusterPolicy CR (e.g. with kubectl edit) will be overwritten by the Helm upgrade due to the <cite>force</cite> flag.</p> </div></div> <h3 id=\"applying_the_helm_chart_update\">Applying the Helm Chart Update</h3> <p>To apply the Helm chart update, run:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ helm upgrade -n nvidia-network-operator network-operator nvidia/network-operator --version=&lt;VERSION&gt; -f values-&lt;VERSION&gt;.yaml --force</div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The –devel option is required if you wish to use the Beta release.</p> </div></div> <h3 id=\"ofed_driver_manual_upgrade\">OFED Driver Manual Upgrade</h3> <h4 id=\"restarting_pods_with_a_containerized_ofed_driver\">Restarting Pods with a Containerized OFED Driver</h4> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>This operation is required only if containerized OFED is in use.</p> </div></div> <p>When a containerized OFED driver is reloaded on the node, all pods that use a secondary network based on NVIDIA NICs will lose network interface in their containers. To prevent outage, remove all pods that use a secondary network from the node before you reload the driver pod on it.</p> <p>The Helm upgrade command will only upgrade the DaemonSet spec of the OFED driver to point to the new driver version. The OFED driver’s DaemonSet will not automatically restart pods with the driver on the nodes, as it uses “OnDelete” updateStrategy. The old OFED version will still run on the node until you explicitly remove the driver pod or reboot the node:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl delete pod -l app=mofed-&lt;OS_NAME&gt; -n nvidia-network-operator</div></pre></div> <p>It is possible to remove all pods with secondary networks from all cluster nodes, and then restart the OFED pods on all nodes at once.</p> <p>The alternative option is to perform an upgrade in a rolling manner to reduce the impact of the driver upgrade on the cluster. The driver pod restart can be done on each node individually. In this case, pods with secondary networks should be removed from the single node only. There is no need to stop pods on all nodes.</p> <p>For each node, follow these steps to reload the driver on the node:</p> <ol class=\"arabic simple\"> <li><p>Remove pods with a secondary network from the node.</p></li> <li><p>Restart the OFED driver pod.</p></li> <li><p>Return the pods with a secondary network to the node.</p></li> </ol> <p>When the OFED driver is ready, proceed with the same steps for other nodes.</p> <h4 id=\"removing_pods_with_a_secondary_network_from_the_node\">Removing Pods with a Secondary Network from the Node</h4> <p>To remove pods with a secondary network from the node with node drain, run the following command:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl drain &lt;NODE_NAME&gt; --pod-selector=&lt;SELECTOR_FOR_PODS&gt;</div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Replace &lt;NODE_NAME&gt; with -l “network.nvidia.com/operator.mofed.wait=false” if you wish to drain all nodes at once.</p> </div></div> <h4 id=\"restarting_the_ofed_driver_pod\">Restarting the OFED Driver Pod</h4> <p>Find the OFED driver pod name for the node:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl get pod -l app=mofed-&lt;OS_NAME&gt; -o wide -A</div></pre></div> <p>Example for Ubuntu 20.04:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl get pod -l app=mofed-ubuntu20.04 -o wide -A</div></pre></div> <h4 id=\"deleting_the_ofed_driver_pod_from_the_node\">Deleting the OFED Driver Pod from the Node</h4> <p>To delete the OFED driver pod from the node, run:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl delete pod -n &lt;DRIVER_NAMESPACE&gt; &lt;OFED_POD_NAME&gt;</div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Replace &lt;OFED_POD_NAME&gt; with -l app=mofed-ubuntu20.04 if you wish to remove OFED pods on all nodes at once.</p> </div></div> <p>A new version of the OFED pod will automatically start.</p> <h5 id=\"returning_pods_with_a_secondary_network_to_the_node\">Returning Pods with a Secondary Network to the Node</h5> <p>After the OFED pod is ready on the node, you can make the node schedulable again.</p> <p>The command below will uncordon (remove node.kubernetes.io/unschedulable:NoSchedule taint) the node, and return the pods to it:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl uncordon -l \"network.nvidia.com/operator.mofed.wait=false\"</div></pre></div> <h3 id=\"automatic_ofed_driver_upgrade\">Automatic OFED Driver Upgrade</h3> <p>To enable automatic OFED upgrade, define the UpgradePolicy section for the ofedDriver in the NicClusterPolicy spec, and change the OFED version.</p> <p><bsp-code-inline code=\"nicclusterpolicy.yaml\">nicclusterpolicy.yaml</bsp-code-inline>:</p> apiVersion: mellanox.com/v1alpha1 kind: NicClusterPolicy metadata: name: nic-cluster-policy namespace: nvidia-network-operator spec: ofedDriver: image: doca-driver repository: nvcr.io/nvidia/mellanox version: 24.04-0.6.6.0-0 upgradePolicy: # autoUpgrade is a global switch for automatic upgrade feature # if set to false all other options are ignored autoUpgrade: true # maxParallelUpgrades indicates how many nodes can be upgraded in parallel # 0 means no limit, all nodes will be upgraded in parallel maxParallelUpgrades: 0 # cordon and drain (if enabled) a node before loading the driver on it safeLoad: false # describes the configuration for waiting on job completions waitForCompletion: # specifies a label selector for the pods to wait for completion podSelector: \"app=myapp\" # specify the length of time in seconds to wait before giving up for workload to finish, zero means infinite # if not specified, the default is 300 seconds timeoutSeconds: 300 # describes configuration for node drain during automatic upgrade drain: # allow node draining during upgrade enable: true # allow force draining force: false # specify a label selector to filter pods on the node that need to be drained podSelector: \"\" # specify the length of time in seconds to wait before giving up drain, zero means infinite # if not specified, the default is 300 seconds timeoutSeconds: 300 # specify if should continue even if there are pods using emptyDir deleteEmptyDir: false <p>Apply NicClusterPolicy CRD:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">$ kubectl apply -f nicclusterpolicy.yaml</div></pre></div> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>To be able to drain nodes, make sure to fill the PodDisruptionBudget field for all the pods that use it. On some clusters (e.g. Openshift), many pods use PodDisruptionBudget, which makes draining multiple nodes at once impossible. Since evicting several pods that are controlled by the same deployment or replica set, violates their PodDisruptionBudget, those pods are not evicted and in drain failure.</p> <p>To perform a driver upgrade, the network-operator must evict pods that are using network resources. Therefore, in order to ensure that the network-operator is evicting only the required pods, the upgradePolicy.drain.podSelector field must be configured.</p> </div></div> <h4 id=\"node_upgrade_states\">Node Upgrade States</h4> <p>The status upgrade of each node is reflected in its nvidia.com/ofed-driver-upgrade-state label . This label can have the following values:</p> <table> <colgroup> <col style=\"width: 50%\"> <col style=\"width: 50%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Name</p></th> <th class=\"head\"><p>Description</p></th> </tr> <tr class=\"row-even\"><td>Unknown (empty)</td> <td>The node has this state when the upgrade flow is disabled or the node has not been processed yet.</td> </tr> <tr class=\"row-odd\"><td><bsp-code-inline code=\"upgrade-done\">upgrade-done</bsp-code-inline></td> <td>Set when OFED POD is up-to-date and running on the node, the node is schedulable.</td> </tr> <tr class=\"row-even\"><td><bsp-code-inline code=\"upgrade-required\">upgrade-required</bsp-code-inline></td> <td>Set when OFED POD on the node is not up-to-date and requires upgrade. No actions are performed at this stage.</td> </tr> <tr class=\"row-odd\"><td><bsp-code-inline code=\"cordon-required\">cordon-required</bsp-code-inline></td> <td>Set when the node needs to be made unschedulable in preparation for driver upgrade.</td> </tr> <tr class=\"row-even\"><td><bsp-code-inline code=\"wait-for-jobs-required\">wait-for-jobs-required</bsp-code-inline></td> <td>Set on the node when waiting is required for jobs to complete until the given timeout.</td> </tr> <tr class=\"row-odd\"><td><bsp-code-inline code=\"drain-required\">drain-required</bsp-code-inline></td> <td>Set when the node is scheduled for drain. After the drain, the state is changed either to pod-restart-required or upgrade-failed.</td> </tr> <tr class=\"row-even\"><td><bsp-code-inline code=\"pod-restart-required\">pod-restart-required</bsp-code-inline></td> <td>Set when the OFED POD on the node is scheduled for restart. After the restart, the state is changed to uncordon-required.</td> </tr> <tr class=\"row-odd\"><td><bsp-code-inline code=\"uncordon-required\">uncordon-required</bsp-code-inline></td> <td>Set when OFED POD on the node is up-to-date and has “Ready” status. After uncordone, the state is changed to upgrade-done</td> </tr> <tr class=\"row-even\"><td><bsp-code-inline code=\"upgrade-failed\">upgrade-failed</bsp-code-inline></td> <td>Set when the upgrade on the node has failed. Manual interaction is required at this stage. See Troubleshooting section for more details.</td> </tr> </tbody> </table> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>Depending on your cluster workloads and pod Disruption Budget, set the following values for auto upgrade:</p> apiVersion: mellanox.com/v1alpha1 kind: NicClusterPolicy metadata: name: nic-cluster-policy namespace: nvidia-network-operator spec: ofedDriver: image: doca-driver repository: nvcr.io/nvidia/mellanox version: 24.04-0.6.6.0-0 upgradePolicy: autoUpgrade: true maxParallelUpgrades: 1 drain: enable: true force: false deleteEmptyDir: true podSelector: \"\" </div></div> <h4 id=\"safe_driver_loading\">Safe Driver Loading</h4> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>The state of this feature can be controlled with the ofedDriver.upgradePolicy.safeLoad option.</p> </div></div> <p>Upon node startup, the OFED container takes some time to compile and load the driver. During that time, workloads might get scheduled on that node. When OFED is loaded, all existing PODs that use NVIDIA NICs will lose their network interfaces. Some such PODs might silently fail or hang. To avoid this situation, before the OFED container is loaded, the node should get cordoned and drained to ensure all workloads are rescheduled. The node should be un-cordoned when the driver is ready on it.</p> <p>The safe driver loading feature is implemented as a part of the upgrade flow, meaning safe driver loading is a special scenario of the upgrade procedure, where we upgrade from the inbox driver to the containerized OFED.</p> <p>When this feature is enabled, the initial OFED driver rollout on the large cluster can take a while. To speed up the rollout, the initial deployment can be done with the safe driver loading feature disabled, and this feature can be enabled later by updating the NicClusterPolicy CRD.</p> <h5 id=\"troubleshooting\">Troubleshooting</h5> <table> <colgroup> <col style=\"width: 50%\"> <col style=\"width: 50%\"> </colgroup> <tbody> <tr> <th class=\"head\"><p>Issue</p></th> <th class=\"head\"><p>Required Action</p></th> </tr> <tr class=\"row-even\"><td>The node is in upgrade-failed state.</td> <td><ul class=\"simple\"> <li class=\"has-marker\">Drain the node manually by running kubectl drain <node name> –ignore-daemonsets.</node></li> <li class=\"has-marker\">Delete the MLNX_OFED pod on the node manually, by running the following command: <bsp-code-inline>kubectl delete pod -n `kubectl get pods --A --field-selector spec.nodeName=&lt;node name&gt; -l nvidia.com/ofed-driver --no-headers | awk '{print $1 \" \"$2}'`</bsp-code-inline>.</li> </ul> <b>NOTE:</b> If the “Safe driver loading” feature is enabled, you may also need to remove the <bsp-code-inline code=\"nvidia.com/ofed-driver-upgrade.driver-wait-for-safe-load\">nvidia.com/ofed-driver-upgrade.driver-wait-for-safe-load</bsp-code-inline> annotation from the node object to unblock the loading of the driver <bsp-code-inline>kubectl annotate node &lt;node_name&gt; nvidia.com/ofed-driver-upgrade.driver-wait-for-safe-load-</bsp-code-inline> <ul class=\"simple\"> <li class=\"has-marker\">Wait for the node to complete the upgrade.</li> </ul> </td> </tr> <tr class=\"row-odd\"><td>The updated MLNX_OFED pod failed to start/ a new version of MLNX_OFED cannot be installed on the node.</td> <td>Manually delete the pod by using <bsp-code-inline>kubectl delete -n &lt;Network Operator Namespace&gt; &lt;pod name&gt;</bsp-code-inline>. If following the restart the pod still fails, change the MLNX_OFED version in the NicClusterPolicy to the previous version or to another working version.</td> </tr> </tbody> </table> <h2 id=\"uninstalling_the_network_operator\">Uninstalling the Network Operator</h2> <h3 id=\"uninstalling_network_operator_on_a_vanilla_kubernetes_cluster\">Uninstalling Network Operator on a Vanilla Kubernetes Cluster</h3> <p>Uninstall the Network Operator:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">helm uninstall network-operator -n nvidia-network-operator</div></pre></div> <p>You should now see all the pods being deleted:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl get pods -n nvidia-network-operator</div></pre></div> <p>Make sure that the CRDs created during the operator installation have been removed:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">kubectl get nicclusterpolicies.mellanox.com</div><div class=\"code-line\">No resources found</div></pre></div> <h3 id=\"uninstalling_the_network_operator_on_an_openshift_cluster\">Uninstalling the Network Operator on an OpenShift Cluster</h3> <p>From the console:</p> <p>In the OpenShift Container Platform web console side menu, select <b>Operators &gt;Installed Operators</b>, search for the <b>NVIDIA Network Operator</b>, and click on it.</p> <p>On the right side of the <b>Operator Details</b> page, select <b>Uninstall Operator</b> from the <b>Actions</b> drop-down menu.</p> <p>For additional information, see the <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/4.10/operators/admin/olm-deleting-operators-from-cluster.html\" target=\"_self\">Red Hat OpenShift Container Platform Documentation</a>.</p> <p>From the CLI:</p> <div class=\"indent\"> <ul> <li class=\"has-marker\"><p>Check the current version of the Network Operator in the currentCSV field:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc get subscription -n nvidia-network-operator nvidia-network-operator -o yaml <span class=\"p\">|</span> grep currentCSV</div></pre></div> <p>Example output:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">currentCSV: nvidia-network-operator.v24.1.0</div></pre></div> </li> <li class=\"has-marker\"><p>Delete the subscription:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc delete subscription -n nvidia-network-operator nvidia-network-operator</div></pre></div> <p>Example output:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">subscription.operators.coreos.com \"nvidia-network-operator\" deleted</div></pre></div> </li> <li class=\"has-marker\"><p>Delete the CSV using the currentCSV value from the previous step:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">subscription.operators.coreos.com \"nvidia-network-operator\" deleted</div></pre></div> <p>Example output:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">clusterserviceversion.operators.coreos.com \"nvidia-network-operator.v10.0\" deleted</div></pre></div> </li> </ul> <br> </div> <p>The SR-IOV Network Operator uninstallation procedure is described in this document. For additional information, see the <a class=\"reference external\" href=\"https://docs.openshift.com/container-platform/4.10/operators/admin/olm-deleting-operators-from-cluster.html\" target=\"_self\">Red Hat OpenShift Container Platform Documentation</a>.</p> <h3 id=\"additional_steps\">Additional Steps</h3> <div class=\"call-out-box option-warning\"><div class=\"call-out-box-title\"> Warning </div><div class=\"call-out-box-body\"> <p>In OCP, uninstalling an operator does not remove its managed resources, including CRDs and CRs. To remove them, you must manually delete the Operator CRDs following the operator uninstallation.</p> </div></div> <p>Delete the Network Operator CRDs:</p> <div class=\"code-body application/x-sh\"><pre><div class=\"code-line\">oc delete crds hostdevicenetworks.mellanox.com macvlannetworks.mellanox.com nicclusterpolicies.mellanox.com</div></pre></div> <h2 id=\"nicclusterpolicy_crd_update\">NicClusterPolicy CRD Update</h2><p>If the NicClusterPolicy manual update affects the device plugin configuration (e.g. NICs selectors), manual device plugin pods restart is required.</p> </div></body></html>",
                "topicPages": [],
                "date": "08/08/2024"
            }
        ],
        "date": "08/08/2024",
        "legalNotice": "oejr\r\nerwjpoe\r\nerwioehire\r\nwioerhwei\r\neohriwher\r\neohreihrhiewr\r\nhewroihwehr"
    },
    "status": "ok"
}